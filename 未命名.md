
 å±•å½¢ERPè´¢åŠ¡ç»“ç®—æ–¹æ¡ˆè®¾è®¡ï¼ˆä¿®è®¢ç‰ˆ v4ï¼‰

> [!abstract] ğŸ“‹ æ–‡æ¡£æ¦‚è§ˆ
> **æ ¸å¿ƒç›®æ ‡**ï¼šåœ¨å¤ç”¨ç°æœ‰ financial ä½“ç³»åŸºç¡€ä¸Šï¼Œæ‰©å±•æ”¯æŒé’¢æè´¸æ˜“å«èµ„ç»“ç®—åœºæ™¯
>
> **ä¸»è¦åŠŸèƒ½**ï¼š
> - å«èµ„åˆ©æ¯è®¡ç®—ï¼ˆè‡ªæœ‰èµ„é‡‘/é“¶è¡Œå«èµ„ï¼‰
> - é€šé“è´¹è®¡ç®—ï¼ˆé˜¶æ¢¯æ­¥è¿›ï¼Œ30å¤©å…è´¹æœŸï¼‰
> - è´´æ¯è®¡ç®—ï¼ˆé“¶è¡Œæ±‡ç¥¨è´´ç°ï¼‰
> - ç‰©æµè´¹ç”¨ç®¡ç†ï¼ˆèˆ¹è¿/æ¸¯å£/ä»“å‚¨/åŠ å·¥/è£…å¸ï¼‰
>
> **è®¾è®¡åŸåˆ™**ï¼š
> - âœ… å¤ç”¨ç°æœ‰æ¶æ„ï¼ˆç»§æ‰¿ BaseBill/BaseDocï¼‰
> - âœ… é…ç½®é©±åŠ¨ï¼ˆè´¹ç‡å‚æ•°è¡¨ï¼‰
> - âœ… å…¬å¼å¿«ç…§å®¡è®¡ï¼ˆJSONå­˜å‚¨ï¼‰
> - âœ… å‘åå…¼å®¹ï¼ˆä¸ç ´åæ—§æ•°æ®ï¼‰

 æ¦‚è¿°

 åŸºäºç™½æ¿åˆ†æå’Œç°æœ‰ç³»ç»Ÿæ¶æ„ï¼Œåœ¨å¤ç”¨ç°æœ‰ financial ä½“ç³»çš„åŸºç¡€ä¸Šï¼Œæ‰©å±•æ”¯æŒå±•å½¢é’¢æè´¸æ˜“çš„å«èµ„ç»“ç®—åœºæ™¯ã€‚

 ---
 ã€‡ã€å£å¾„å®šä¹‰ä¸æŠ€æœ¯å†³ç­–ï¼ˆå·²é‡‡ç”¨é»˜è®¤å€¼ï¼‰

> [!success] âœ… å£å¾„å·²å†»ç»“ï¼Œå¯ç›´æ¥å¼€å‘
> ä»¥ä¸‹å£å¾„å·²é‡‡ç”¨é»˜è®¤å€¼ï¼Œåç»­å¯é€šè¿‡é…ç½®è¡¨è°ƒæ•´ã€‚
>
> **å…³é”®å†³ç­–**ï¼š
> - å«èµ„åˆ©æ¯ï¼šå«ç¨é‡‘é¢ Ã— å¹´åŒ–18% / 360 Ã— å¤©æ•°
> - é€šé“è´¹ï¼š30å¤©å…è´¹æœŸ + 0.5å…ƒ/å¨/å¤©é˜¶æ¢¯è®¡è´¹
> - è´´æ¯ï¼šæ±‡ç¥¨é‡‘é¢ Ã— å¹´åŒ–2.3% / 360 Ã— å¤©æ•°
> - ç‰©æµè´¹ï¼šæ‰‹å·¥å½•å…¥æ¨¡å¼ï¼ˆç”¨æˆ·å¡«å•ä»·ï¼‰

 âœ… ä»¥ä¸‹å£å¾„å·²é‡‡ç”¨é»˜è®¤å€¼ï¼Œå¯ç›´æ¥å¼€å§‹å¼€å‘ï¼›åç»­å¯é€šè¿‡é…ç½®è¡¨è°ƒæ•´

 0.1 å«èµ„åˆ©æ¯å£å¾„ï¼ˆé‡‡ç”¨é»˜è®¤å€¼ï¼Œå¯åç»­è°ƒæ•´ï¼‰

> [!example] ğŸ’° å«èµ„åˆ©æ¯è®¡ç®—å…¬å¼
> **å…¬å¼**ï¼š`åˆ©æ¯ = å«èµ„é‡‘é¢(å«ç¨) Ã— å¹´åŒ–åˆ©ç‡ / 360 Ã— å«èµ„å¤©æ•°`
>
> **æ ¸å¿ƒå‚æ•°**ï¼š
> - è®¡æ¯åŸºæ•°ï¼šå«ç¨é‡‘é¢
> - åˆ©ç‡æ¢ç®—ï¼šå¹´åŒ–/360
> - è®¡æ¯åŒºé—´ï¼šä»˜æ¬¾æ—¥ â†’ å›æ¬¾æ—¥ï¼ˆè‡ªç„¶æ—¥ï¼‰
> - å¹´åŒ–åˆ©ç‡ï¼š18%ï¼ˆè‡ªæœ‰èµ„é‡‘ï¼Œå¯é…ç½®ï¼‰
>
> **éªŒæ”¶ç®—ä¾‹**ï¼š
> - 100ä¸‡ Ã— 18% / 360 Ã— 30å¤© = 15,000å…ƒ
> - 100ä¸‡ Ã— 18% / 360 Ã— 60å¤© = 30,000å…ƒ

 å†³ç­–ï¼šé‡‡ç”¨ä»¥ä¸‹é»˜è®¤å€¼å¯åŠ¨å¼€å‘ï¼Œåç»­å¯é€šè¿‡é…ç½®è¡¨è°ƒæ•´

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   å‚æ•°   â”‚  ç¡®å®šå€¼  â”‚               è¯´æ˜                â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è®¡æ¯åŸºæ•° â”‚ å«ç¨é‡‘é¢ â”‚ å«èµ„æœ¬é‡‘ = é‡‡è´­å«ç¨é‡‘é¢           â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ åˆ©ç‡æ¢ç®— â”‚ å¹´åŒ–/360 â”‚ æ—¥åˆ©ç‡ = å¹´åŒ–åˆ©ç‡ / 360           â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è®¡æ¯èµ·æ—¥ â”‚ ä»˜æ¬¾æ—¥   â”‚ advanceStartDate                  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è®¡æ¯æ­¢æ—¥ â”‚ å›æ¬¾æ—¥   â”‚ advanceEndDate                    â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å¤©æ•°è®¡ç®— â”‚ è‡ªç„¶æ—¥   â”‚ advanceDays = endDate - startDate â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å‘ä¸Šå–æ•´ â”‚ å¦       â”‚ ä¸è¶³ä¸€å¤©æŒ‰å®é™…å¤©æ•°                â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ é˜¶æ¢¯è§„åˆ™ â”‚ æ—        â”‚ å•ä¸€åˆ©ç‡ï¼Œä¸åˆ†é˜¶æ¢¯                â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å°é¡¶è§„åˆ™ â”‚ æ—        â”‚ æ— åˆ©æ¯ä¸Šé™                        â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è·¨æœŸå¤„ç† â”‚ ç»Ÿä¸€åˆ©ç‡ â”‚ ä¸åˆ†æ®µï¼ŒæŒ‰ç»Ÿä¸€åˆ©ç‡è®¡ç®—            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å¹´åŒ–åˆ©ç‡ â”‚ 18%      â”‚ è‡ªæœ‰èµ„é‡‘å«èµ„ï¼ˆå¯é…ç½®ï¼‰            â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 åˆ©æ¯è®¡ç®—å…¬å¼ï¼š
 åˆ©æ¯ = å«èµ„é‡‘é¢(å«ç¨) Ã— å¹´åŒ–åˆ©ç‡ / 360 Ã— å«èµ„å¤©æ•°

 å…¶ä¸­ï¼š
 - å«èµ„å¤©æ•° = endDate - startDateï¼ˆè‡ªç„¶æ—¥å·®ï¼Œä¸å«é¦–æ—¥å«æœ«æ—¥ï¼‰
 - æ•°å€¼ç²¾åº¦ï¼šé‡‘é¢ä¿ç•™2ä½ï¼Œæ—¥åˆ©ç‡å­˜6ä½
 - èˆå…¥æ¨¡å¼ï¼šBigDecimal.ROUND_HALF_UP

 å¤©æ•°è¾¹ç•Œå¤„ç†ï¼š
 - åŒæ—¥ï¼ˆstartDate == endDateï¼‰â†’ å¤©æ•°=0ï¼Œåˆ©æ¯=0
 - èµ·æ—¥>æ­¢æ—¥ â†’ æ ¡éªŒæ‹’ç»ï¼ŒæŠ›å‡ºå¼‚å¸¸
 - è·¨æœˆ/è·¨å¹´ â†’ æ­£å¸¸è®¡ç®—è‡ªç„¶æ—¥å·®

 éªŒæ”¶ç®—ä¾‹ï¼ˆ5ä¸ªï¼‰ï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ åºå· â”‚ å«èµ„é‡‘é¢(å«ç¨) â”‚ å¹´åŒ–åˆ©ç‡ â”‚  èµ·æ­¢æ—¥  â”‚ å¤©æ•° â”‚           åˆ©æ¯è®¡ç®—           â”‚    ç»“æœ    â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 1    â”‚ 1,000,000      â”‚ 18%      â”‚ 1/1-1/31 â”‚ 30   â”‚ 1,000,000 Ã— 0.18 / 360 Ã— 30  â”‚ 15,000.00  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 2    â”‚ 1,000,000      â”‚ 18%      â”‚ 1/1-3/1  â”‚ 60   â”‚ 1,000,000 Ã— 0.18 / 360 Ã— 60  â”‚ 30,000.00  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 3    â”‚ 500,000        â”‚ 18%      â”‚ 1/1-2/15 â”‚ 45   â”‚ 500,000 Ã— 0.18 / 360 Ã— 45    â”‚ 11,250.00  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 4    â”‚ 2,000,000      â”‚ 18%      â”‚ 1/1-4/30 â”‚ 120  â”‚ 2,000,000 Ã— 0.18 / 360 Ã— 120 â”‚ 120,000.00 â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 5    â”‚ 800,000        â”‚ 12%      â”‚ 1/1-1/16 â”‚ 15   â”‚ 800,000 Ã— 0.12 / 360 Ã— 15    â”‚ 4,000.00   â”‚
 â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 0.2 ç‰©æµè´¹ç”¨å£å¾„ï¼ˆæ‰‹å·¥å½•å…¥æ¨¡å¼ï¼‰

 å†³ç­–ï¼šç‰©æµè´¹ç”¨é‡‡ç”¨æ‰‹å·¥å½•å…¥æ¨¡å¼ï¼Œç”¨æˆ·å¡«å†™å•ä»·ï¼Œç³»ç»Ÿè®¡ç®—é‡‘é¢

 è´¹ç”¨å½•å…¥æ¨¡å¼è¯´æ˜ï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚              è´¹ç”¨ç±»å‹              â”‚   å½•å…¥æ¨¡å¼   â”‚                  è¯´æ˜                  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å«èµ„åˆ©æ¯                           â”‚ é…ç½®è¡¨å–å‚   â”‚ ä» financial_expense_config è¯»å–åˆ©ç‡   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ é€šé“è´¹                             â”‚ é…ç½®è¡¨å–å‚   â”‚ ä» financial_expense_config è¯»å–è´¹ç‡   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è´´æ¯                               â”‚ é…ç½®è¡¨å–å‚   â”‚ ä» financial_expense_config è¯»å–è´´æ¯ç‡ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ èˆ¹è¿è´¹/æ¸¯å£è´¹/ä»“å‚¨è´¹/åŠ å·¥è´¹/è£…å¸è´¹ â”‚ ç”¨æˆ·æ‰‹å·¥å¡«å†™ â”‚ ç”¨æˆ·åœ¨è´¹ç”¨æ˜ç»†ä¸­å½•å…¥å•ä»·               â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 ç‰©æµè´¹ç”¨æ˜ç»†ï¼ˆæ‰‹å·¥å½•å…¥ï¼‰ï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ è´¹ç”¨ç±»å‹ â”‚    è®¡è´¹åŸºæ•°     â”‚ å•ä»·æ¥æº â”‚        å…¬å¼        â”‚    è¯´æ˜    â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ èˆ¹è¿è´¹   â”‚ æ•°é‡(å¨)        â”‚ ç”¨æˆ·å¡«å†™ â”‚ æ•°é‡ Ã— å•ä»·        â”‚ æŒ‰å¨è®¡è´¹   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ æ¸¯å£è´¹   â”‚ æ•°é‡(å¨)        â”‚ ç”¨æˆ·å¡«å†™ â”‚ æ•°é‡ Ã— å•ä»·        â”‚ æŒ‰å¨è®¡è´¹   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ ä»“å‚¨è´¹   â”‚ æ•°é‡(å¨) Ã— å¤©æ•° â”‚ ç”¨æˆ·å¡«å†™ â”‚ æ•°é‡ Ã— å•ä»· Ã— å¤©æ•° â”‚ æŒ‰å¨å¤©è®¡è´¹ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ åŠ å·¥è´¹   â”‚ æ•°é‡(å¨)        â”‚ ç”¨æˆ·å¡«å†™ â”‚ æ•°é‡ Ã— å•ä»·        â”‚ æŒ‰å¨è®¡è´¹   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è£…å¸è´¹   â”‚ æ•°é‡(å¨)        â”‚ ç”¨æˆ·å¡«å†™ â”‚ æ•°é‡ Ã— å•ä»·        â”‚ æŒ‰å¨è®¡è´¹   â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 æ³¨æ„ï¼šç‰©æµè´¹ç”¨ä¸èµ°é…ç½®è¡¨ï¼Œç”¨æˆ·ç›´æ¥åœ¨è´¹ç”¨æ˜ç»†è¡Œä¸­å¡«å†™å•ä»·å’Œæ•°é‡ï¼Œåç«¯ä»…è®¡ç®—é‡‘é¢

 è´¹ç”¨è®¡ç®—å…¬å¼ï¼š
 æ™®é€šè´¹ç”¨ = æ•°é‡(å¨) Ã— å•ä»·(å…ƒ/å¨)
 ä»“å‚¨è´¹ç”¨ = æ•°é‡(å¨) Ã— å•ä»·(å…ƒ/å¨/å¤©) Ã— å¤©æ•°

 éªŒæ”¶ç®—ä¾‹ï¼ˆ5ä¸ªï¼‰ï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ åºå· â”‚ è´¹ç”¨ç±»å‹ â”‚ æ•°é‡(å¨) â”‚    å•ä»·     â”‚ å¤©æ•° â”‚    é‡‘é¢è®¡ç®—    â”‚   ç»“æœ    â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 1    â”‚ èˆ¹è¿è´¹   â”‚ 500      â”‚ 50å…ƒ/å¨     â”‚ -    â”‚ 500 Ã— 50       â”‚ 25,000.00 â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 2    â”‚ æ¸¯å£è´¹   â”‚ 500      â”‚ 15å…ƒ/å¨     â”‚ -    â”‚ 500 Ã— 15       â”‚ 7,500.00  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 3    â”‚ ä»“å‚¨è´¹   â”‚ 500      â”‚ 0.5å…ƒ/å¨/å¤© â”‚ 30   â”‚ 500 Ã— 0.5 Ã— 30 â”‚ 7,500.00  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 4    â”‚ åŠ å·¥è´¹   â”‚ 300      â”‚ 80å…ƒ/å¨     â”‚ -    â”‚ 300 Ã— 80       â”‚ 24,000.00 â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 5    â”‚ è£…å¸è´¹   â”‚ 500      â”‚ 8å…ƒ/å¨      â”‚ -    â”‚ 500 Ã— 8        â”‚ 4,000.00  â”‚
 â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 0.3 ä¸ç°æœ‰è¡¨çš„å…³ç³»ç¡®è®¤

> [!question] ğŸ”‘ æ¶æ„å†³ç­–ç‚¹
> **ç°æœ‰ç»“æ„**ï¼š
> - `financial_settlement` - ä¸»è¡¨ï¼ˆæœ‰ `otherExpensesAmount` å•ä¸€è´¹ç”¨å­—æ®µï¼‰
> - `financial_settlement_detail` - å•†å“æ˜ç»†è¡¨
>
> **å†³ç­–**ï¼šæ¨èæ–¹æ¡ˆB - æ–°å»º `financial_settlement_expense` è¡¨
> - âœ… èŒè´£æ¸…æ™°ï¼Œç‹¬ç«‹ç®¡ç†è´¹ç”¨æ˜ç»†
> - âœ… å•†å“æ˜ç»†ä¸è´¹ç”¨æ˜ç»†åˆ†ç¦»
> - âœ… ç‹¬ç«‹çš„è´¹ç”¨ç±»å‹å­—å…¸
> - âœ… `otherExpensesAmount` æ”¹ä¸ºä» expense è¡¨æ±‡æ€»è®¡ç®—

 ç°æœ‰ç»“æ„åˆ†æï¼š
 - financial_settlement - ä¸»è¡¨ï¼ˆç»§æ‰¿ BaseBillï¼Œæœ‰ otherExpensesAmount å•ä¸€è´¹ç”¨å­—æ®µï¼‰
 - financial_settlement_detail - å•†å“æ˜ç»†è¡¨ï¼ˆSKUã€æ•°é‡ã€ä»·æ ¼ã€ç¨é¢ï¼‰

 å†³ç­–ç‚¹ï¼šæ‰©å±•ç°æœ‰è¡¨ vs æ–°å»ºè´¹ç”¨è¡¨
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚          æ–¹æ¡ˆ          â”‚        ä¼˜ç‚¹        â”‚                      ç¼ºç‚¹                      â”‚  å»ºè®®  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ æ–¹æ¡ˆA: æ‰©å±• detail è¡¨  â”‚ å¤ç”¨ç°æœ‰ç»“æ„       â”‚ å•†å“æ˜ç»†ä¸è´¹ç”¨æ˜ç»†æ··åœ¨ä¸€èµ·ï¼Œéœ€åŠ  type å­—æ®µåŒºåˆ† â”‚ ä¸æ¨è â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ æ–¹æ¡ˆB: æ–°å»º expense è¡¨ â”‚ èŒè´£æ¸…æ™°ï¼Œç‹¬ç«‹ç®¡ç† â”‚ éœ€æ–°å¢ Entity/Mapper/Service                   â”‚ æ¨è   â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 æ¨èæ–¹æ¡ˆBï¼šæ–°å»º financial_settlement_expense è¡¨
 - ä¸ financial_settlement_detailï¼ˆå•†å“æ˜ç»†ï¼‰å¹¶è¡Œ
 - ç‹¬ç«‹çš„è´¹ç”¨ç±»å‹å­—å…¸
 - ä¸»è¡¨ otherExpensesAmount å­—æ®µæ”¹ä¸ºä» expense è¡¨æ±‡æ€»è®¡ç®—

 0.4 ç°æœ‰ otherExpensesAmount å­—æ®µå¤„ç†

 ç°çŠ¶ï¼š
 - otherExpensesAmount åœ¨ BaseBill ä¸­å®šä¹‰ï¼Œè¢« FinancialSettlement ç»§æ‰¿
 - å½“å‰ä¸ºæ‰‹å·¥å¡«å†™çš„å•ä¸€åˆè®¡å­—æ®µ
 - å…¬å¼ï¼šactualAmount = goodsAmount + otherExpensesAmount - discountAmount

 æ”¹é€ æ–¹æ¡ˆï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   é¡¹ç›®   â”‚    æ”¹é€ å‰    â”‚        æ”¹é€ å         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ æ•°æ®æ¥æº â”‚ æ‰‹å·¥å¡«å†™     â”‚ ä» expense è¡¨è‡ªåŠ¨æ±‡æ€» â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å­—æ®µç”¨é€” â”‚ å…¶ä»–è´¹ç”¨åˆè®¡ â”‚ ä¿ç•™ï¼Œä½œä¸ºæ±‡æ€»å­—æ®µ    â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ ç¼–è¾‘æ–¹å¼ â”‚ ç›´æ¥ç¼–è¾‘     â”‚ åªè¯»ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰      â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å‘åå…¼å®¹ â”‚ -            â”‚ æ—§æ•°æ®ä¿æŒä¸å˜        â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Service å±‚æ”¹é€ ï¼š
 // ä¿å­˜æ—¶è‡ªåŠ¨è®¡ç®— otherExpensesAmount
 public void saveExpenseList(Long settlementId, List<FinancialSettlementExpenseBo> expenseList) {
     // 1. ä¿å­˜è´¹ç”¨æ˜ç»†
     // ...

     // 2. æ±‡æ€»è´¹ç”¨åˆ°ä¸»è¡¨ otherExpensesAmount
     BigDecimal totalExpense = expenseList.stream()
         .map(FinancialSettlementExpenseBo::getAmount)
         .filter(Objects::nonNull)
         .reduce(BigDecimal.ZERO, BigDecimal::add);

     // 3. æ›´æ–°ä¸»è¡¨ï¼ˆåŒæ—¶æ›´æ–° otherExpensesAmount å’Œ totalExpenseAmountï¼‰
     baseMapper.update(null, Wrappers.<FinancialSettlement>lambdaUpdate()
         .eq(FinancialSettlement::getId, settlementId)
         .set(FinancialSettlement::getOtherExpensesAmount, totalExpense)
         .set(FinancialSettlement::getTotalExpenseAmount, totalExpense));

     // 4. actualAmount åœ¨æ•°æ®åº“è§¦å‘å™¨æˆ–åº”ç”¨å±‚è‡ªåŠ¨è®¡ç®—
 }

 å‰ç«¯æ”¹é€ ï¼š
 - otherExpensesAmount å­—æ®µæ”¹ä¸ºåªè¯»å±•ç¤º
 - ç”¨æˆ·é€šè¿‡è´¹ç”¨æ˜ç»† Tab æ·»åŠ /ç¼–è¾‘è´¹ç”¨
 - ä¿å­˜æ—¶åç«¯è‡ªåŠ¨æ±‡æ€»

 0.5 æ—§æ•°æ®å…¼å®¹ä¸è¿ç§»ç­–ç•¥

 å‘åå…¼å®¹åŸåˆ™ï¼š
 - å·²æœ‰å•æ®çš„ otherExpensesAmount ä¿æŒä¸å˜
 - æ–°å•æ®é€šè¿‡è´¹ç”¨æ˜ç»†è¡¨è®¡ç®—
 - ä¸å¼ºåˆ¶è¿ç§»æ—§æ•°æ®

 æ•°æ®è¿ç§»æ–¹æ¡ˆï¼ˆå¯é€‰ï¼‰ï¼š
 -- 1. æŸ¥æ‰¾æœ‰ otherExpensesAmount ä½†æ— è´¹ç”¨æ˜ç»†çš„æ—§å•æ®
 SELECT id, doc_no, other_expenses_amount
 FROM financial_settlement
 WHERE other_expenses_amount > 0
   AND del_flag = '0'
   AND id NOT IN (SELECT DISTINCT pid FROM financial_settlement_expense WHERE del_flag = '0');

 -- 2. ä¸ºæ—§æ•°æ®åˆ›å»º"å…¶ä»–è´¹ç”¨"æ˜ç»†ï¼ˆå¯é€‰ï¼Œæ‰‹å·¥æ‰§è¡Œï¼‰
 INSERT INTO financial_settlement_expense (pid, expense_type, expense_name, amount, remark, tenant_id)
 SELECT id, 99, 'å…¶ä»–è´¹ç”¨ï¼ˆå†å²è¿ç§»ï¼‰', other_expenses_amount, 'ä»æ—§æ•°æ®è¿ç§»', tenant_id
 FROM financial_settlement
 WHERE other_expenses_amount > 0
   AND del_flag = '0'
   AND id NOT IN (SELECT DISTINCT pid FROM financial_settlement_expense WHERE del_flag = '0');

 å…¼å®¹åˆ¤æ–­é€»è¾‘ï¼š
 // æŸ¥è¯¢æ—¶åˆ¤æ–­æ˜¯å¦ä¸ºæ—§æ•°æ®
 public FinancialSettlementVo queryById(Long id) {
     FinancialSettlementVo vo = super.queryById(id);

     List<FinancialSettlementExpenseVo> expenses = expenseMapper.selectByPid(id);
     vo.setExpenseList(expenses);

     // æ—§æ•°æ®åˆ¤æ–­ï¼šæœ‰ otherExpensesAmount ä½†æ— è´¹ç”¨æ˜ç»†
     if (CollUtil.isEmpty(expenses) && vo.getOtherExpensesAmount() != null
         && vo.getOtherExpensesAmount().compareTo(BigDecimal.ZERO) > 0) {
         vo.setLegacyData(true); // æ ‡è®°ä¸ºæ—§æ•°æ®ï¼Œå‰ç«¯æ˜¾ç¤ºæç¤º
     }

     return vo;
 }

 0.6 å‚æ•°é…ç½®å–å‚é€»è¾‘

> [!tip] ğŸ¯ é…ç½®å–å‚è§„åˆ™
> **ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰**ï¼š
> 1. æŒ‡å®šå•†æˆ· + å½“å‰ç”Ÿæ•ˆ â†’ ä¼˜å…ˆä½¿ç”¨
> 2. å…¨å±€é…ç½®ï¼ˆmerchant_id IS NULLï¼‰+ å½“å‰ç”Ÿæ•ˆ â†’ æ¬¡é€‰
> 3. æ— åŒ¹é… â†’ æŠ›å‡ºå¼‚å¸¸
>
> **æœ‰æ•ˆæœŸè§„åˆ™**ï¼š
> - `effective_date <= è®¡ç®—æ—¥æœŸ <= expiry_date`
> - `expiry_date` ä¸ºç©ºè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ
> - åŒä¸€ `config_code` ä¸å…è®¸æœ‰æ•ˆæœŸé‡å 
>
> **calc_method è®¡ç®—æ–¹å¼**ï¼š
> - `1` = æŒ‰å¤©Ã—è´¹ç‡
> - `2` = é˜¶æ¢¯æ­¥è¿›ï¼ˆè§£æ tier_rules JSONï¼‰
> - `3` = å›ºå®šé‡‘é¢

 é…ç½®ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
 1. æŒ‡å®šå•†æˆ· + å½“å‰ç”Ÿæ•ˆ â†’ ä¼˜å…ˆä½¿ç”¨
 2. å…¨å±€é…ç½®ï¼ˆmerchant_id IS NULLï¼‰+ å½“å‰ç”Ÿæ•ˆ â†’ æ¬¡é€‰
 3. æ— åŒ¹é… â†’ æŠ›å‡ºå¼‚å¸¸

 æœ‰æ•ˆæœŸè§„åˆ™ï¼š
 - effective_date <= å½“å‰æ—¥æœŸ <= expiry_dateï¼ˆexpiry_date ä¸ºç©ºè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆï¼‰
 - åŒä¸€ config_code ä¸å…è®¸æœ‰æ•ˆæœŸé‡å 

 å–å‚é€»è¾‘ï¼š
 public FinancialExpenseConfig getEffectiveConfig(String configCode, Long merchantId, LocalDate calcDate) {
     // 1. ä¼˜å…ˆæŸ¥æ‰¾æŒ‡å®šå•†æˆ·çš„é…ç½®
     FinancialExpenseConfig config = configMapper.selectOne(Wrappers.<FinancialExpenseConfig>lambdaQuery()
         .eq(FinancialExpenseConfig::getConfigCode, configCode)
         .eq(FinancialExpenseConfig::getMerchantId, merchantId)
         .le(FinancialExpenseConfig::getEffectiveDate, calcDate)
         .and(w -> w.isNull(FinancialExpenseConfig::getExpiryDate)
             .or().ge(FinancialExpenseConfig::getExpiryDate, calcDate))
         .eq(FinancialExpenseConfig::getStatus, 1)
         .orderByDesc(FinancialExpenseConfig::getEffectiveDate)
         .last("LIMIT 1"));

     if (config != null) {
         return config;
     }

     // 2. æŸ¥æ‰¾å…¨å±€é…ç½®
     config = configMapper.selectOne(Wrappers.<FinancialExpenseConfig>lambdaQuery()
         .eq(FinancialExpenseConfig::getConfigCode, configCode)
         .isNull(FinancialExpenseConfig::getMerchantId)
         .le(FinancialExpenseConfig::getEffectiveDate, calcDate)
         .and(w -> w.isNull(FinancialExpenseConfig::getExpiryDate)
             .or().ge(FinancialExpenseConfig::getExpiryDate, calcDate))
         .eq(FinancialExpenseConfig::getStatus, 1)
         .orderByDesc(FinancialExpenseConfig::getEffectiveDate)
         .last("LIMIT 1"));

     if (config == null) {
         throw new ServiceException("æœªæ‰¾åˆ°æœ‰æ•ˆçš„è´¹ç‡é…ç½®ï¼š" + configCode);
     }

     return config;
 }

 calc_method ä¸å…¬å¼å¯¹åº”ï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚  calc_method  â”‚             è®¡ç®—é€»è¾‘              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 1 (æŒ‰å¤©Ã—è´¹ç‡) â”‚ amount = base Ã— rate / 360 Ã— days â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 2 (é˜¶æ¢¯æ­¥è¿›)  â”‚ è§£æ tier_rules JSONï¼ŒæŒ‰é˜¶æ¢¯è®¡ç®—  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 3 (å›ºå®šé‡‘é¢)  â”‚ amount = rate_valueï¼ˆç›´æ¥å–å€¼ï¼‰   â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 base_type ä¸åŸºæ•°å¯¹åº”ï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   base_type    â”‚                åŸºæ•°å–å€¼                â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 1 (å«ç¨é‡‘é¢)   â”‚ settlement.goodsAmount                 â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 2 (ä¸å«ç¨é‡‘é¢) â”‚ settlement.goodsAmount / (1 + taxRate) â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 3 (æ•°é‡)       â”‚ settlement.goodsQty                    â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 0.7 è´¹ç”¨è¡¨å”¯ä¸€é”®å¤„ç†

 ç°æœ‰å”¯ä¸€é”®ï¼š
 CREATE UNIQUE INDEX uk_expense_source
     ON financial_settlement_expense(pid, expense_type, source_doc_id)
     WHERE del_flag = '0' AND source_doc_id IS NOT NULL;

 é—®é¢˜ï¼šæ—  source_doc_id æ—¶å¯èƒ½é‡å¤

 è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ åºå·å­—æ®µ
 -- æ–°å¢åºå·å­—æ®µ
 ALTER TABLE financial_settlement_expense
 ADD COLUMN IF NOT EXISTS seq_no SMALLINT DEFAULT 1;

 -- ä¿®æ”¹å”¯ä¸€é”®ï¼ˆè¦†ç›–æ— æ¥æºåœºæ™¯ï¼‰
 CREATE UNIQUE INDEX IF NOT EXISTS uk_expense_type_seq
     ON financial_settlement_expense(pid, expense_type, seq_no)
     WHERE del_flag = '0';

 ä¸šåŠ¡è§„åˆ™ï¼š
 - åŒä¸€ç»“ç®—å•ä¸‹ï¼ŒåŒä¸€è´¹ç”¨ç±»å‹å¯æœ‰å¤šæ¡ï¼ˆseq_no é€’å¢ï¼‰
 - æœ‰ source_doc_id æ—¶ï¼Œç”¨åŸå”¯ä¸€é”®ä¿è¯ä¸é‡å¤
 - æ—  source_doc_id æ—¶ï¼Œç”¨ (pid, expense_type, seq_no) ä¿è¯å”¯ä¸€

 seq_no ç”Ÿæˆé€»è¾‘ï¼ˆåç«¯ï¼‰ï¼š
 public void saveExpenseList(Long settlementId, List<FinancialSettlementExpenseBo> expenseList) {
     // 1. åˆ é™¤åŸæœ‰è´¹ç”¨æ˜ç»†
     expenseMapper.deleteByPid(settlementId);

     if (CollUtil.isEmpty(expenseList)) {
         return;
     }

     // 2. æŒ‰è´¹ç”¨ç±»å‹åˆ†ç»„ï¼Œç”Ÿæˆ seq_no
     Map<Integer, AtomicInteger> seqMap = new HashMap<>();

     List<FinancialSettlementExpense> entities = expenseList.stream()
         .map(bo -> {
             FinancialSettlementExpense entity = MapstructUtils.convert(bo, FinancialSettlementExpense.class);
             entity.setPid(settlementId);

             // ç”Ÿæˆ seq_noï¼ˆåŒç±»å‹é€’å¢ï¼‰
             int expenseType = entity.getExpenseType();
             AtomicInteger seq = seqMap.computeIfAbsent(expenseType, k -> new AtomicInteger(0));
             entity.setSeqNo(seq.incrementAndGet());

             return entity;
         })
         .collect(Collectors.toList());

     // 3. æ‰¹é‡æ’å…¥
     expenseMapper.insertBatch(entities);

     // 4. æ›´æ–°ä¸»è¡¨è´¹ç”¨åˆè®¡
     updateExpenseTotal(settlementId);
 }

 å‰ç«¯ä¸éœ€è¦ä¼  seq_noï¼Œç”±åç«¯è‡ªåŠ¨ç”Ÿæˆ

 ---
 ä¸€ã€è´¹ç”¨å£å¾„å®šä¹‰ï¼ˆå·²éƒ¨åˆ†ç¡®è®¤ï¼‰

 1.1 å«èµ„åˆ©æ¯å£å¾„ï¼ˆå¾…å†»ç»“ - è§ 0.1ï¼‰

 1.2 é€šé“è´¹å£å¾„ï¼ˆå·²ç¡®è®¤ï¼‰

> [!example] ğŸš› é€šé“è´¹è®¡ç®—å…¬å¼
> **å…¬å¼**ï¼š
> - è‹¥ å«èµ„å¤©æ•° â‰¤ 30å¤©ï¼š`é€šé“è´¹ = 0`
> - è‹¥ å«èµ„å¤©æ•° > 30å¤©ï¼š`é€šé“è´¹ = æ•°é‡(å¨) Ã— (å«èµ„å¤©æ•° - 30) Ã— 0.5å…ƒ/å¨/å¤©`
>
> **æ ¸å¿ƒå‚æ•°**ï¼š
> - å…è´¹æœŸï¼š30å¤©
> - æ­¥è¿›å‘¨æœŸï¼š1å¤©
> - å•ä»·ï¼š0.5å…ƒ/å¨/å¤©
>
> **éªŒæ”¶ç®—ä¾‹**ï¼š
> - 500å¨ Ã— 25å¤© = 0å…ƒï¼ˆå…è´¹æœŸå†…ï¼‰
> - 500å¨ Ã— 35å¤© = 500 Ã— 5 Ã— 0.5 = 1,250å…ƒ

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   å‚æ•°   â”‚   ç¡®å®šå€¼    â”‚         è¯´æ˜          â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è®¡è´¹åŸºæ•° â”‚ æ•°é‡ï¼ˆå¨ï¼‰  â”‚ æŒ‰å¨æ•°è®¡è´¹            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å…è´¹æœŸ   â”‚ 30å¤©        â”‚ å‰30å¤©å…é€šé“è´¹        â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ æ­¥è¿›å‘¨æœŸ â”‚ 1å¤©         â”‚ è¶…è¿‡30å¤©åï¼Œæ¯1å¤©ç´¯è®¡ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å•ä»·     â”‚ 0.5å…ƒ/å¨/å¤© â”‚ è¶…æœŸè´¹ç‡              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è®¡è´¹æ–¹å¼ â”‚ é˜¶æ¢¯æ­¥è¿›    â”‚ å…è´¹æœŸ + æŒ‰å¤©ç´¯è®¡     â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 é€šé“è´¹è®¡ç®—å…¬å¼ï¼š
 è‹¥ å«èµ„å¤©æ•° <= 30å¤©ï¼š
     é€šé“è´¹ = 0

 è‹¥ å«èµ„å¤©æ•° > 30å¤©ï¼š
     è¶…æœŸå¤©æ•° = å«èµ„å¤©æ•° - 30
     æ­¥è¿›æ¬¡æ•° = CEILING(è¶…æœŸå¤©æ•° / N)  // Nä¸ºæ­¥è¿›å‘¨æœŸï¼ˆå¦‚2å¤©ï¼‰
     é€šé“è´¹ = æ•°é‡(å¨) Ã— æ­¥è¿›æ¬¡æ•° Ã— å•æ¬¡è´¹ç”¨(å…ƒ/å¨)

 å·²ç¡®è®¤å‚æ•°ï¼š
 - å…è´¹æœŸï¼š30å¤©
 - æ­¥è¿›å‘¨æœŸï¼š1å¤©
 - å•æ¬¡è´¹ç”¨ï¼š0.5å…ƒ/å¨

 æœ€ç»ˆå…¬å¼ï¼š
 è‹¥ å«èµ„å¤©æ•° <= 30å¤©ï¼š
     é€šé“è´¹ = 0

 è‹¥ å«èµ„å¤©æ•° > 30å¤©ï¼š
     è¶…æœŸå¤©æ•° = å«èµ„å¤©æ•° - 30
     é€šé“è´¹ = æ•°é‡(å¨) Ã— è¶…æœŸå¤©æ•° Ã— 0.5(å…ƒ/å¨/å¤©)

 éªŒæ”¶ç®—ä¾‹ï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ åºå· â”‚ å«èµ„å¤©æ•° â”‚ æ•°é‡(å¨) â”‚ è¶…æœŸå¤©æ•° â”‚   é€šé“è´¹è®¡ç®—    â”‚   ç»“æœ   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 1    â”‚ 25å¤©     â”‚ 500      â”‚ 0        â”‚ å…è´¹æœŸå†…        â”‚ 0å…ƒ      â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 2    â”‚ 30å¤©     â”‚ 500      â”‚ 0        â”‚ å…è´¹æœŸå†…        â”‚ 0å…ƒ      â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 3    â”‚ 35å¤©     â”‚ 500      â”‚ 5        â”‚ 500 Ã— 5 Ã— 0.5   â”‚ 1,250å…ƒ  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 4    â”‚ 45å¤©     â”‚ 500      â”‚ 15       â”‚ 500 Ã— 15 Ã— 0.5  â”‚ 3,750å…ƒ  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 5    â”‚ 60å¤©     â”‚ 1000     â”‚ 30       â”‚ 1000 Ã— 30 Ã— 0.5 â”‚ 15,000å…ƒ â”‚
 â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 1.3 è´´æ¯å£å¾„ï¼ˆå·²ç¡®è®¤ï¼‰

> [!example] ğŸ¦ è´´æ¯è®¡ç®—å…¬å¼
> **å…¬å¼**ï¼š`è´´æ¯ = æ±‡ç¥¨é‡‘é¢ Ã— è´´æ¯ç‡ Ã— è´´ç°å¤©æ•° / 360`
>
> **æ ¸å¿ƒå‚æ•°**ï¼š
> - è´´æ¯åŸºæ•°ï¼šæ±‡ç¥¨é‡‘é¢ï¼ˆå«ç¨ï¼‰
> - è´´æ¯ç‡ï¼š2.3%ï¼ˆå¹´åŒ–ï¼‰
> - å¤©æ•°åŸºå‡†ï¼š360å¤©/å¹´
> - è´´ç°æœŸé™ï¼šæŒ‰å®é™…å¤©æ•°
>
> **éªŒæ”¶ç®—ä¾‹**ï¼š
> - 100ä¸‡ Ã— 2.3% Ã— 120å¤© / 360 = 7,666.67å…ƒ
> - 50ä¸‡ Ã— 2.3% Ã— 60å¤© / 360 = 1,916.67å…ƒ

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   å‚æ•°   â”‚      ç¡®è®¤å€¼      â”‚        è¯´æ˜         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è®¡ç®—æ–¹å¼ â”‚ é“¶è¡Œæ±‡ç¥¨è´´ç°     â”‚ æŒ‰é“¶è¡Œè´´ç°æƒ¯ä¾‹è®¡ç®—  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è´´æ¯åŸºæ•° â”‚ æ±‡ç¥¨é‡‘é¢ï¼ˆå«ç¨ï¼‰ â”‚ é‡‡è´­ä»˜æ¬¾çš„å«ç¨é‡‘é¢  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è´´æ¯ç‡   â”‚ 2.3%ï¼ˆå¹´åŒ–ï¼‰     â”‚ å¹´åŒ–è´´æ¯ç‡          â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å¤©æ•°åŸºå‡† â”‚ 360å¤©/å¹´         â”‚ é“¶è¡Œè´´ç°æƒ¯ä¾‹        â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è´´ç°æœŸé™ â”‚ æŒ‰å®é™…å¤©æ•°       â”‚ å«èµ„å¤©æ•°ï¼ˆå¦‚120å¤©ï¼‰ â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 è´´æ¯è®¡ç®—å…¬å¼ï¼š
 è´´æ¯ = æ±‡ç¥¨é‡‘é¢ Ã— è´´æ¯ç‡ Ã— è´´ç°å¤©æ•° / 360

 å…¶ä¸­ï¼š
 - æ±‡ç¥¨é‡‘é¢ = é‡‡è´­ä»˜æ¬¾å«ç¨é‡‘é¢
 - è´´æ¯ç‡ = 2.3%ï¼ˆå¹´åŒ–ï¼Œå³0.023ï¼‰
 - è´´ç°å¤©æ•° = å«èµ„å¤©æ•°ï¼ˆä»˜æ¬¾æ—¥åˆ°å›æ¬¾æ—¥ï¼‰

 éªŒæ”¶ç®—ä¾‹ï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ åºå· â”‚ æ±‡ç¥¨é‡‘é¢ â”‚ è´´æ¯ç‡ â”‚ å¤©æ•°  â”‚           è´´æ¯è®¡ç®—            â”‚    ç»“æœ     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 1    â”‚ 100ä¸‡    â”‚ 2.3%   â”‚ 120å¤© â”‚ 1,000,000 Ã— 0.023 Ã— 120 / 360 â”‚ 7,666.67å…ƒ  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 2    â”‚ 100ä¸‡    â”‚ 2.3%   â”‚ 90å¤©  â”‚ 1,000,000 Ã— 0.023 Ã— 90 / 360  â”‚ 5,750.00å…ƒ  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 3    â”‚ 50ä¸‡     â”‚ 2.3%   â”‚ 60å¤©  â”‚ 500,000 Ã— 0.023 Ã— 60 / 360    â”‚ 1,916.67å…ƒ  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ 4    â”‚ 200ä¸‡    â”‚ 2.3%   â”‚ 180å¤© â”‚ 2,000,000 Ã— 0.023 Ã— 180 / 360 â”‚ 23,000.00å…ƒ â”‚
 â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 é€‚ç”¨åœºæ™¯ï¼š
 - é“¶è¡Œå«èµ„æ¨¡å¼ä¸‹ï¼Œå±•å½¢éœ€æ‰¿æ‹…çš„é“¶è¡Œè´´æ¯è´¹ç”¨
 - è´´æ¯ç‡å¯åœ¨å‚æ•°è¡¨ä¸­é…ç½®ï¼Œæ”¯æŒæŒ‰å•†æˆ·/æ—¶é—´æ®µè°ƒæ•´

 1.4 ç‰©æµè´¹ç”¨å£å¾„
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ è´¹ç”¨ç±»å‹ â”‚ è®¡ç®—å…¬å¼ â”‚  åŸºæ•°  â”‚   å•ä½   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ èˆ¹è¿è´¹   â”‚ å¾…ç¡®è®¤   â”‚ å¾…ç¡®è®¤ â”‚ å…ƒ/å¨    â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ æ¸¯å£è´¹   â”‚ å¾…ç¡®è®¤   â”‚ å¾…ç¡®è®¤ â”‚ å…ƒ/å¨    â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ ä»“å‚¨è´¹   â”‚ å¾…ç¡®è®¤   â”‚ å¾…ç¡®è®¤ â”‚ å…ƒ/å¨/å¤© â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ åŠ å·¥è´¹   â”‚ å¾…ç¡®è®¤   â”‚ å¾…ç¡®è®¤ â”‚ å…ƒ/å¨    â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è£…å¸è´¹   â”‚ å¾…ç¡®è®¤   â”‚ å¾…ç¡®è®¤ â”‚ å…ƒ/å¨    â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 ---
 äºŒã€ç°æœ‰æ¶æ„å¯¹é½

> [!tip] ğŸ—ï¸ æ¶æ„è®¾è®¡å…³é”®ç‚¹
> **å¤ç”¨ç°æœ‰ç»§æ‰¿é“¾**ï¼šFinancialSettlement â†’ BaseFinancialSettlement â†’ BaseBill â†’ BaseDoc â†’ BaseEntity
>
> **å­—æ®µå¤ç”¨ç­–ç•¥**ï¼š
> - `otherExpensesAmount`ï¼ˆBaseBillï¼‰â†’ æ”¹ä¸ºä» expense è¡¨è‡ªåŠ¨æ±‡æ€»ï¼ˆåªè¯»ï¼‰
> - `prepayAmount` â†’ ä¿ç•™ç”¨äºå…¶ä»–ç”¨é€”ï¼Œæ–°å¢ `advanceAmount` å­—æ®µ
>
> **æ–°å¢è¡¨è®¾è®¡**ï¼š
> - `financial_settlement_expense` - è´¹ç”¨æ˜ç»†è¡¨ï¼ˆä¸å•†å“æ˜ç»†å¹¶è¡Œï¼‰
> - `financial_expense_config` - è´¹ç”¨å‚æ•°é…ç½®è¡¨ï¼ˆæ”¯æŒæŒ‰å•†æˆ·/æ—¶é—´æ®µé…ç½®ï¼‰
>
> **å‘åå…¼å®¹**ï¼š
> - æ—§å•æ®ä¿æŒä¸å˜ï¼Œä¸å¼ºåˆ¶è¿ç§»
> - æŸ¥è¯¢æ—¶åˆ¤æ–­ `legacyData` æ ‡è®°
> - å¯é€‰æ‹©æ€§æ‰§è¡Œå†å²æ•°æ®è¿ç§»è„šæœ¬

 2.1 å®ä½“ç»§æ‰¿é“¾ï¼ˆå·²ç¡®è®¤ï¼‰

 FinancialSettlement
   â””â”€â”€ BaseFinancialSettlement (6å­—æ®µ: deliveryDate, operatorId, weightSlipType, sourceType, period)
         â””â”€â”€ BaseBill (5å­—æ®µ: otherExpensesAmount, discountAmount, actualAmount, merchantId, prepayAmount)
               â””â”€â”€ BaseDoc (7å­—æ®µ: id, docNo, docDate, goodsQty, goodsAmount, checkedStatus, warehouseId, remark)
                     â””â”€â”€ BaseEntity (6å­—æ®µ: createDept, createBy, createTime, updateBy, updateTime, params)

 2.2 ç°æœ‰å­—æ®µå¤ç”¨
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚      ç°æœ‰å­—æ®µ       â”‚   ä½ç½®   â”‚                     å¤ç”¨æ–¹å¼                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ otherExpensesAmount â”‚ BaseBill â”‚ å¯ç”¨äºå­˜å‚¨è´¹ç”¨åˆè®¡ï¼Œä½†å»ºè®®æ–°å¢æ˜ç»†è¡¨å­˜å‚¨å„é¡¹è´¹ç”¨ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ discountAmount      â”‚ BaseBill â”‚ ä¿æŒåŸç”¨é€”ï¼ˆä¼˜æƒ é‡‘é¢ï¼‰                           â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ actualAmount        â”‚ BaseBill â”‚ ä¿æŒåŸè®¡ç®—é€»è¾‘                                   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ prepayAmount        â”‚ BaseBill â”‚ å¯ç”¨äºå«èµ„é‡‘é¢ï¼ˆæˆ–æ–°å¢ advanceAmountï¼‰           â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 2.3 éœ€è¦æ‰©å±•çš„å­—æ®µ

 åœ¨ FinancialSettlement å®ä½“ä¸­æ–°å¢ä»¥ä¸‹å­—æ®µï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚       å­—æ®µå       â”‚    ç±»å‹    â”‚                 è¯´æ˜                 â”‚       ä½ç½®        â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ advanceType        â”‚ Integer    â”‚ å«èµ„ç±»å‹ï¼š0=æ—  1=è‡ªæœ‰èµ„é‡‘ 2=é“¶è¡Œå«èµ„ â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ advanceAmount      â”‚ BigDecimal â”‚ å«èµ„é‡‘é¢                             â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ advanceStartDate   â”‚ LocalDate  â”‚ è®¡æ¯å¼€å§‹æ—¥                           â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ advanceEndDate     â”‚ LocalDate  â”‚ è®¡æ¯ç»“æŸæ—¥                           â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ advanceDays        â”‚ Integer    â”‚ å«èµ„å¤©æ•°                             â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ interestRate       â”‚ BigDecimal â”‚ æ—¥åˆ©ç‡å¿«ç…§ï¼ˆä¿å­˜è®¡ç®—æ—¶çš„åˆ©ç‡ï¼‰       â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ interestAmount     â”‚ BigDecimal â”‚ åˆ©æ¯é‡‘é¢                             â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ channelFeeRate     â”‚ BigDecimal â”‚ é€šé“è´¹ç‡å¿«ç…§                         â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ channelFeeAmount   â”‚ BigDecimal â”‚ é€šé“è´¹é‡‘é¢                           â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ subsidyRate        â”‚ BigDecimal â”‚ è´´æ¯æ¯”ä¾‹å¿«ç…§                         â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ subsidyAmount      â”‚ BigDecimal â”‚ è´´æ¯é‡‘é¢                             â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ formulaSnapshot    â”‚ String     â”‚ å®Œæ•´å…¬å¼å¿«ç…§ï¼ˆJSONï¼‰                 â”‚ Entity            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ totalExpenseAmount â”‚ BigDecimal â”‚ è´¹ç”¨æ˜ç»†åˆè®¡                         â”‚ Entity/VOè®¡ç®—å­—æ®µ â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 2.4 BO/VO/Mapper æ‰©å±•ä½ç½®
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   å±‚    â”‚              æ–‡ä»¶               â”‚         æ‰©å±•æ–¹å¼          â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Entity  â”‚ FinancialSettlement.java        â”‚ ç›´æ¥æ·»åŠ å­—æ®µ              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Bo      â”‚ FinancialSettlementBo.java      â”‚ æ·»åŠ å­—æ®µ + @ExcelProperty â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Vo      â”‚ FinancialSettlementVo.java      â”‚ æ·»åŠ å­—æ®µ + Excelæ³¨è§£      â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Mapper  â”‚ FinancialSettlementMapper.xml   â”‚ è‡ªåŠ¨ç»§æ‰¿ï¼Œæ— éœ€ä¿®æ”¹        â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Service â”‚ FinancialSettlementService.java â”‚ æ·»åŠ è®¡ç®—æ–¹æ³•              â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 2.5 MapStruct è½¬æ¢ï¼ˆè‡ªåŠ¨ï¼‰

 ç”±äºä½¿ç”¨ @AutoMapper æ³¨è§£ï¼Œå­—æ®µæ‰©å±•å MapStruct ä¼šè‡ªåŠ¨å¤„ç†è½¬æ¢ï¼š

 // Entity -> Bo
 FinancialSettlementBo bo = MapstructUtils.convert(entity, FinancialSettlementBo.class);

 // Bo -> Entity (ä¿å­˜æ—¶)
 FinancialSettlement entity = MapstructUtils.convert(bo, FinancialSettlement.class);

 ---
 ä¸‰ã€æ•°æ®åº“æ‰©å±•

> [!note] ğŸ’¾ æ•°æ®åº“å˜æ›´æ€»è§ˆ
> **æ‰©å±•è¡¨ï¼ˆ1ä¸ªï¼‰**ï¼š
> - `financial_settlement` - æ–°å¢12ä¸ªå«èµ„ç›¸å…³å­—æ®µ
>
> **æ–°å»ºè¡¨ï¼ˆ2ä¸ªï¼‰**ï¼š
> - `financial_settlement_expense` - è´¹ç”¨æ˜ç»†è¡¨ï¼ˆä¸å•†å“æ˜ç»†å¹¶è¡Œï¼‰
> - `financial_expense_config` - è´¹ç”¨å‚æ•°é…ç½®è¡¨
>
> **å­—å…¸æ•°æ®ï¼ˆ3ç»„ï¼‰**ï¼š
> - `erp_advance_type` - å«èµ„ç±»å‹ï¼ˆæ— /è‡ªæœ‰èµ„é‡‘/é“¶è¡Œå«èµ„ï¼‰
> - `erp_expense_type` - è´¹ç”¨ç±»å‹ï¼ˆèˆ¹è¿/æ¸¯å£/ä»“å‚¨/åŠ å·¥/è£…å¸/å…¶ä»–ï¼‰
> - `erp_base_type` - è´¹ç‡åŸºæ•°ç±»å‹ï¼ˆå«ç¨/ä¸å«ç¨/æ•°é‡ï¼‰
>
> **å”¯ä¸€é”®çº¦æŸ**ï¼š
> - `uk_expense_type_seq` - åŒä¸€ç»“ç®—å•ä¸‹åŒç±»å‹è´¹ç”¨åºå·å”¯ä¸€
> - `uk_expense_source` - åŒä¸€ç»“ç®—å•ä¸‹åŒæ¥æºå•æ®å”¯ä¸€

 3.1 æ‰©å±• financial_settlement è¡¨

 -- ==========================================
 -- å«èµ„ç›¸å…³å­—æ®µæ‰©å±•
 -- ==========================================

 -- å«èµ„ç±»å‹ï¼š0=æ— å«èµ„ 1=è‡ªæœ‰èµ„é‡‘ 2=é“¶è¡Œå«èµ„
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS advance_type SMALLINT DEFAULT 0;

 -- å«èµ„é‡‘é¢
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS advance_amount NUMERIC(18,2) DEFAULT 0;

 -- è®¡æ¯å¼€å§‹æ—¥
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS advance_start_date DATE;

 -- è®¡æ¯ç»“æŸæ—¥
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS advance_end_date DATE;

 -- å«èµ„å¤©æ•°
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS advance_days INTEGER DEFAULT 0;

 -- æ—¥åˆ©ç‡å¿«ç…§ï¼ˆç²¾åº¦åˆ°å°æ•°ç‚¹å6ä½ï¼Œå¦‚ 0.000500 = 0.05%ï¼‰
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS interest_rate NUMERIC(10,6) DEFAULT 0;

 -- åˆ©æ¯é‡‘é¢
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS interest_amount NUMERIC(18,2) DEFAULT 0;

 -- é€šé“è´¹ç‡å¿«ç…§
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS channel_fee_rate NUMERIC(10,6) DEFAULT 0;

 -- é€šé“è´¹é‡‘é¢
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS channel_fee_amount NUMERIC(18,2) DEFAULT 0;

 -- è´´æ¯æ¯”ä¾‹å¿«ç…§ï¼ˆç²¾åº¦åˆ°å°æ•°ç‚¹å4ä½ï¼Œå¦‚ 0.3000 = 30%ï¼‰
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS subsidy_rate NUMERIC(6,4) DEFAULT 0;

 -- è´´æ¯é‡‘é¢
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS subsidy_amount NUMERIC(18,2) DEFAULT 0;

 -- å…¬å¼å¿«ç…§ï¼ˆJSONæ ¼å¼ï¼Œå­˜å‚¨è®¡ç®—æ—¶çš„å®Œæ•´å‚æ•°ï¼‰
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS formula_snapshot TEXT;

 -- è´¹ç”¨æ˜ç»†åˆè®¡
 ALTER TABLE financial_settlement
 ADD COLUMN IF NOT EXISTS total_expense_amount NUMERIC(18,2) DEFAULT 0;

 -- ç´¢å¼•
 CREATE INDEX IF NOT EXISTS idx_settlement_advance_type
     ON financial_settlement(advance_type)
     WHERE del_flag = '0';

 3.2 æ–°å»ºè´¹ç”¨æ˜ç»†è¡¨

> [!important] ğŸ“‹ è´¹ç”¨æ˜ç»†è¡¨è®¾è®¡è¦ç‚¹
> **èŒè´£**ï¼šå­˜å‚¨å„é¡¹è´¹ç”¨æ˜ç»†ï¼ˆå«èµ„åˆ©æ¯ã€é€šé“è´¹ã€è´´æ¯ã€ç‰©æµè´¹ï¼‰
>
> **å…³é”®å­—æ®µ**ï¼š
> - `seq_no` - åºå·ï¼ˆåç«¯è‡ªåŠ¨ç”Ÿæˆï¼Œå‰ç«¯æ— éœ€ä¼ å…¥ï¼‰
> - `formula_snapshot` - å…¬å¼å¿«ç…§ï¼ˆJSONæ ¼å¼ï¼‰
> - `source_doc_id` - æ¥æºå•æ®IDï¼ˆå¯é€‰ï¼‰
>
> **å”¯ä¸€é”®çº¦æŸ**ï¼š
> - `uk_expense_type_seq` - (pid, expense_type, seq_no) åŒç±»å‹åºå·å”¯ä¸€
> - `uk_expense_source` - (pid, expense_type, source_doc_id) åŒæ¥æºå”¯ä¸€
>
> **ä¸å•†å“æ˜ç»†å¹¶è¡Œ**ï¼šä¸æ··åœ¨ä¸€èµ·ï¼ŒèŒè´£æ¸…æ™°

 -- ==========================================
 -- è´¹ç”¨æ˜ç»†è¡¨ï¼ˆä¸å•†å“æ˜ç»† financial_settlement_detail å¹¶è¡Œï¼‰
 -- ==========================================

 CREATE TABLE IF NOT EXISTS financial_settlement_expense (
     -- ä¸»é”®
     id              BIGSERIAL PRIMARY KEY,

     -- å…³è”ç»“ç®—å•ï¼ˆå¤–é”®ï¼‰
     pid             BIGINT NOT NULL,

     -- è´¹ç”¨ä¿¡æ¯
     expense_type    SMALLINT NOT NULL,             -- è´¹ç”¨ç±»å‹ï¼ˆå­—å…¸ erp_expense_typeï¼‰
     expense_name    VARCHAR(100),                  -- è´¹ç”¨åç§°ï¼ˆå†—ä½™ï¼Œä¾¿äºå±•ç¤ºï¼‰
     seq_no          SMALLINT DEFAULT 1 NOT NULL,   -- åºå·ï¼ˆåŒç±»å‹é€’å¢ï¼Œåç«¯è‡ªåŠ¨ç”Ÿæˆï¼‰
     qty             NUMERIC(18,3) DEFAULT 0,       -- æ•°é‡ï¼ˆå¨ï¼‰
     unit_price      NUMERIC(18,6) DEFAULT 0,       -- å•ä»·ï¼ˆç²¾åº¦6ä½ï¼‰
     days            INTEGER DEFAULT 0,             -- å¤©æ•°ï¼ˆä»“å‚¨è´¹ç”¨ï¼‰
     amount          NUMERIC(18,2) DEFAULT 0,       -- é‡‘é¢ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
     tax_rate        NUMERIC(5,2) DEFAULT 0,        -- ç¨ç‡ï¼ˆ%ï¼‰
     tax_amount      NUMERIC(18,2) DEFAULT 0,       -- ç¨é¢
     amount_without_tax NUMERIC(18,2) DEFAULT 0,    -- ä¸å«ç¨é‡‘é¢

     -- æ¥æºå…³è”
     source_doc_type VARCHAR(50),                   -- æ¥æºå•æ®ç±»å‹
     source_doc_no   VARCHAR(50),                   -- æ¥æºå•æ®å·
     source_doc_id   BIGINT,                        -- æ¥æºå•æ®ID

     -- å…¬å¼å¿«ç…§ï¼ˆJSONæ ¼å¼ï¼Œæœ€å¤§10000å­—ç¬¦ï¼‰
     formula_snapshot TEXT,

     -- å¤‡æ³¨
     remark          VARCHAR(500),

     -- ==========================================
     -- æ ‡å‡†å­—æ®µï¼ˆç»§æ‰¿ TenantEntity è§„èŒƒï¼‰
     -- ==========================================
     create_dept     BIGINT,
     create_by       BIGINT,
     create_time     TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
     update_by       BIGINT,
     update_time     TIMESTAMP,
     tenant_id       VARCHAR(20) DEFAULT '000000' NOT NULL,
     del_flag        CHAR(1) DEFAULT '0' NOT NULL,

     -- å¤–é”®çº¦æŸ
     CONSTRAINT fk_expense_settlement_pid
         FOREIGN KEY (pid) REFERENCES financial_settlement(id) ON DELETE CASCADE
 );

 -- ç´¢å¼•
 CREATE INDEX IF NOT EXISTS idx_expense_pid
     ON financial_settlement_expense(pid)
     WHERE del_flag = '0';

 CREATE INDEX IF NOT EXISTS idx_expense_tenant
     ON financial_settlement_expense(tenant_id)
     WHERE del_flag = '0';

 CREATE INDEX IF NOT EXISTS idx_expense_type
     ON financial_settlement_expense(expense_type)
     WHERE del_flag = '0';

 -- å”¯ä¸€çº¦æŸ1ï¼šåŒä¸€ç»“ç®—å•ä¸‹ï¼ŒåŒä¸€è´¹ç”¨ç±»å‹+åºå·å”¯ä¸€ï¼ˆè¦†ç›–æ— æ¥æºåœºæ™¯ï¼‰
 CREATE UNIQUE INDEX IF NOT EXISTS uk_expense_type_seq
     ON financial_settlement_expense(pid, expense_type, seq_no)
     WHERE del_flag = '0';

 -- å”¯ä¸€çº¦æŸ2ï¼šåŒä¸€ç»“ç®—å•ä¸‹ï¼ŒåŒä¸€è´¹ç”¨ç±»å‹+æ¥æºå•æ®å”¯ä¸€ï¼ˆæœ‰æ¥æºæ—¶ï¼‰
 CREATE UNIQUE INDEX IF NOT EXISTS uk_expense_source
     ON financial_settlement_expense(pid, expense_type, source_doc_id)
     WHERE del_flag = '0' AND source_doc_id IS NOT NULL;

 -- æ³¨é‡Š
 COMMENT ON TABLE financial_settlement_expense IS 'ç»“ç®—å•è´¹ç”¨æ˜ç»†è¡¨';
 COMMENT ON COLUMN financial_settlement_expense.expense_type IS 'è´¹ç”¨ç±»å‹ï¼š1=èˆ¹è¿è´¹ 2=æ¸¯å£è´¹ 3=ä»“å‚¨è´¹ 4=åŠ å·¥è´¹
 5=è£…å¸è´¹ 99=å…¶ä»–';
 COMMENT ON COLUMN financial_settlement_expense.formula_snapshot IS
 'JSONæ ¼å¼ï¼š{"rate":0.05,"days":30,"base":1000000,"qty":500,"operator":"admin","time":"2024-01-15"}';

 3.3 æ–°å»ºè´¹ç”¨é…ç½®è¡¨

> [!gear] âš™ï¸ è´¹ç”¨å‚æ•°é…ç½®è¡¨è®¾è®¡
> **èŒè´£**ï¼šå­˜å‚¨è´¹ç‡å‚æ•°ï¼Œæ”¯æŒæŒ‰å•†æˆ·/æ—¶é—´æ®µé…ç½®
>
> **é…ç½®ç±»å‹**ï¼ˆconfig_typeï¼‰ï¼š
> - `1` = å«èµ„åˆ©ç‡ï¼ˆINTEREST_RATE_SELF, INTEREST_RATE_BANKï¼‰
> - `2` = é€šé“è´¹ç‡ï¼ˆCHANNEL_FEEï¼‰
> - `3` = è´´æ¯æ¯”ä¾‹ï¼ˆSUBSIDY_RATEï¼‰
> - `4` = ç‰©æµè´¹ç‡
>
> **è®¡ç®—æ–¹å¼**ï¼ˆcalc_methodï¼‰ï¼š
> - `1` = æŒ‰å¤©Ã—è´¹ç‡ï¼ˆç®€å•è®¡ç®—ï¼‰
> - `2` = é˜¶æ¢¯æ­¥è¿›ï¼ˆè§£æ tier_rules JSONï¼‰
> - `3` = å›ºå®šé‡‘é¢
>
> **å–å‚ä¼˜å…ˆçº§**ï¼šæŒ‡å®šå•†æˆ· > å…¨å±€é…ç½® > å¼‚å¸¸
>
> **æœ‰æ•ˆæœŸç®¡ç†**ï¼šæ”¯æŒæ—¶é—´æ®µç”Ÿæ•ˆï¼ŒåŒä¸€ç¼–ç ä¸å…è®¸é‡å 

 -- ==========================================
 -- è´¹ç”¨å‚æ•°é…ç½®è¡¨
 -- ==========================================

 CREATE TABLE IF NOT EXISTS financial_expense_config (
     -- ä¸»é”®
     id              BIGSERIAL PRIMARY KEY,

     -- é…ç½®æ ‡è¯†
     config_code     VARCHAR(50) NOT NULL,          -- é…ç½®ç¼–ç ï¼ˆå¦‚ INTEREST_RATE_SELF, CHANNEL_FEEï¼‰
     config_name     VARCHAR(100),                  -- é…ç½®åç§°
     config_type     SMALLINT NOT NULL,             -- ç±»å‹ï¼š1=å«èµ„åˆ©ç‡ 2=é€šé“è´¹ç‡ 3=è´´æ¯æ¯”ä¾‹ 4=ç‰©æµè´¹ç‡

     -- è´¹ç‡å‚æ•°
     rate_value      NUMERIC(12,6) DEFAULT 0,       -- è´¹ç‡å€¼
     rate_unit       VARCHAR(20) DEFAULT 'day',     -- å•ä½ï¼šday=æ—¥ month=æœˆ year=å¹´
     base_type       SMALLINT DEFAULT 1,            -- åŸºæ•°ç±»å‹ï¼š1=å«ç¨é‡‘é¢ 2=ä¸å«ç¨é‡‘é¢ 3=æ•°é‡
     calc_method     SMALLINT DEFAULT 1,            -- è®¡ç®—æ–¹å¼ï¼š1=æŒ‰å¤©Ã—è´¹ç‡ 2=é˜¶æ¢¯æ­¥è¿› 3=å›ºå®šé‡‘é¢

     -- é˜¶æ¢¯è§„åˆ™ï¼ˆJSONæ•°ç»„ï¼‰
     tier_rules      TEXT,                          --
 [{"minDays":0,"maxDays":30,"rate":0.0005},{"minDays":31,"maxDays":60,"rate":0.0006}]

     -- é€‚ç”¨èŒƒå›´
     merchant_id     BIGINT,                        -- é€‚ç”¨å•†æˆ·ï¼ˆNULL=å…¨éƒ¨ï¼‰
     expense_type    SMALLINT,                      -- é€‚ç”¨è´¹ç”¨ç±»å‹ï¼ˆNULL=å…¨éƒ¨ï¼‰
     effective_date  DATE NOT NULL,                 -- ç”Ÿæ•ˆæ—¥æœŸ
     expiry_date     DATE,                          -- å¤±æ•ˆæ—¥æœŸï¼ˆNULL=æ°¸ä¹…ï¼‰

     -- çŠ¶æ€
     status          SMALLINT DEFAULT 1,            -- çŠ¶æ€ï¼š0=ç¦ç”¨ 1=å¯ç”¨

     -- æ ‡å‡†å­—æ®µ
     create_dept     BIGINT,
     create_by       BIGINT,
     create_time     TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
     update_by       BIGINT,
     update_time     TIMESTAMP,
     tenant_id       VARCHAR(20) DEFAULT '000000' NOT NULL,
     del_flag        CHAR(1) DEFAULT '0' NOT NULL
 );

 -- å”¯ä¸€ç´¢å¼•ï¼ˆåŒä¸€ç§Ÿæˆ·ã€ç¼–ç ã€ç”Ÿæ•ˆæ—¥æœŸå”¯ä¸€ï¼‰
 CREATE UNIQUE INDEX IF NOT EXISTS uk_expense_config
     ON financial_expense_config(tenant_id, config_code, effective_date)
     WHERE del_flag = '0';

 -- ç´¢å¼•
 CREATE INDEX IF NOT EXISTS idx_config_type
     ON financial_expense_config(config_type)
     WHERE del_flag = '0';

 CREATE INDEX IF NOT EXISTS idx_config_effective
     ON financial_expense_config(effective_date, expiry_date)
     WHERE del_flag = '0' AND status = 1;

 -- æ³¨é‡Š
 COMMENT ON TABLE financial_expense_config IS 'è´¹ç”¨å‚æ•°é…ç½®è¡¨';
 COMMENT ON COLUMN financial_expense_config.tier_rules IS
 'JSONé˜¶æ¢¯è§„åˆ™ï¼š[{"minDays":èµ·å§‹å¤©,"maxDays":ç»“æŸå¤©,"rate":è´¹ç‡}]';

 3.4 å­—å…¸æ•°æ®åˆå§‹åŒ–

 -- ==========================================
 -- å­—å…¸ç±»å‹
 -- ==========================================

 -- å«èµ„ç±»å‹
 INSERT INTO sys_dict_type (dict_name, dict_type, status, create_time, remark, tenant_id)
 VALUES ('å«èµ„ç±»å‹', 'erp_advance_type', '0', NOW(), 'å±•å½¢ERPå«èµ„ç±»å‹', '000000')
 ON CONFLICT DO NOTHING;

 -- è´¹ç”¨ç±»å‹
 INSERT INTO sys_dict_type (dict_name, dict_type, status, create_time, remark, tenant_id)
 VALUES ('è´¹ç”¨ç±»å‹', 'erp_expense_type', '0', NOW(), 'å±•å½¢ERPè´¹ç”¨ç±»å‹', '000000')
 ON CONFLICT DO NOTHING;

 -- è´¹ç‡åŸºæ•°ç±»å‹
 INSERT INTO sys_dict_type (dict_name, dict_type, status, create_time, remark, tenant_id)
 VALUES ('è´¹ç‡åŸºæ•°ç±»å‹', 'erp_base_type', '0', NOW(), 'è´¹ç”¨è®¡ç®—åŸºæ•°ç±»å‹', '000000')
 ON CONFLICT DO NOTHING;

 -- ==========================================
 -- å­—å…¸æ•°æ®
 -- ==========================================

 -- erp_advance_type
 INSERT INTO sys_dict_data (dict_sort, dict_label, dict_value, dict_type, status, create_time, tenant_id)
 VALUES
     (1, 'æ— å«èµ„', '0', 'erp_advance_type', '0', NOW(), '000000'),
     (2, 'è‡ªæœ‰èµ„é‡‘', '1', 'erp_advance_type', '0', NOW(), '000000'),
     (3, 'é“¶è¡Œå«èµ„', '2', 'erp_advance_type', '0', NOW(), '000000')
 ON CONFLICT DO NOTHING;

 -- erp_expense_type
 INSERT INTO sys_dict_data (dict_sort, dict_label, dict_value, dict_type, status, create_time, tenant_id)
 VALUES
     (1, 'èˆ¹è¿è´¹', '1', 'erp_expense_type', '0', NOW(), '000000'),
     (2, 'æ¸¯å£è´¹', '2', 'erp_expense_type', '0', NOW(), '000000'),
     (3, 'ä»“å‚¨è´¹', '3', 'erp_expense_type', '0', NOW(), '000000'),
     (4, 'åŠ å·¥è´¹', '4', 'erp_expense_type', '0', NOW(), '000000'),
     (5, 'è£…å¸è´¹', '5', 'erp_expense_type', '0', NOW(), '000000'),
     (99, 'å…¶ä»–è´¹ç”¨', '99', 'erp_expense_type', '0', NOW(), '000000')
 ON CONFLICT DO NOTHING;

 -- erp_base_type
 INSERT INTO sys_dict_data (dict_sort, dict_label, dict_value, dict_type, status, create_time, tenant_id)
 VALUES
     (1, 'å«ç¨é‡‘é¢', '1', 'erp_base_type', '0', NOW(), '000000'),
     (2, 'ä¸å«ç¨é‡‘é¢', '2', 'erp_base_type', '0', NOW(), '000000'),
     (3, 'æ•°é‡(å¨)', '3', 'erp_base_type', '0', NOW(), '000000')
 ON CONFLICT DO NOTHING;

 ---
 å››ã€å…¬å¼å¿«ç…§ JSON Schema

> [!example] ğŸ“ å…¬å¼å¿«ç…§è®¾è®¡
> **ç”¨é€”**ï¼šå®¡è®¡è¿½æº¯ã€å‚æ•°é”å®šã€å…¬å¼éªŒè¯
>
> **å­˜å‚¨çº¦æŸ**ï¼š
> - å­—æ®µç±»å‹ï¼šTEXTï¼ˆPostgreSQLï¼‰
> - æœ€å¤§é•¿åº¦ï¼š10,000å­—ç¬¦
> - ç¼–ç ï¼šUTF-8 æ ‡å‡†JSON
> - Schemaç‰ˆæœ¬ï¼šv1.0ï¼ˆåç»­å‡çº§éœ€å…¼å®¹ï¼‰
>
> **ä¸¤çº§å¿«ç…§**ï¼š
> - **ç»“ç®—å•çº§åˆ«**ï¼ˆ`formula_snapshot`ï¼‰- åŒ…å« advanceã€channelFeeã€subsidyã€expensesã€summary
> - **è´¹ç”¨æ˜ç»†çº§åˆ«** - æ¯æ¡è´¹ç”¨çš„è®¡ç®—å…¬å¼å’Œå‚æ•°
>
> **åç«¯æ ¡éªŒ**ï¼š
> - é•¿åº¦æ ¡éªŒï¼ˆè¶…è¿‡10000å­—ç¬¦æ‹’ç»ï¼‰
> - JSONæ ¼å¼æ ¡éªŒï¼ˆè§£æå¤±è´¥æ‹’ç»ï¼‰
> - æäº¤å®¡æ‰¹å‰å¿…é¡»ç”Ÿæˆå¿«ç…§

 4.0 å­˜å‚¨çº¦æŸ
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚  çº¦æŸé¡¹  â”‚       è§„æ ¼        â”‚            è¯´æ˜            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å­—æ®µç±»å‹ â”‚ TEXT (PostgreSQL) â”‚ ä¸ä½¿ç”¨ JSON ç±»å‹ï¼Œä¾¿äºè¿ç§» â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ æœ€å¤§é•¿åº¦ â”‚ 10,000 å­—ç¬¦       â”‚ åç«¯æ ¡éªŒï¼Œè¶…é•¿æˆªæ–­æˆ–æ‹’ç»   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ ç¼–ç      â”‚ UTF-8             â”‚ æ ‡å‡† JSON æ ¼å¼             â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å‹ç¼©     â”‚ æ—                 â”‚ ä¿æŒå¯è¯»æ€§ï¼Œä¾¿äºæ’æŸ¥       â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 åç«¯æ ¡éªŒï¼š
 public void validateFormulaSnapshot(String snapshot) {
     if (StringUtils.isBlank(snapshot)) {
         return; // å…è®¸ä¸ºç©ºï¼ˆè‰ç¨¿çŠ¶æ€ï¼‰
     }
     if (snapshot.length() > 10000) {
         throw new ServiceException("å…¬å¼å¿«ç…§è¶…è¿‡10000å­—ç¬¦é™åˆ¶");
     }
     // JSONæ ¼å¼æ ¡éªŒ
     try {
         JsonUtils.parseObject(snapshot, FormulaSnapshot.class);
     } catch (Exception e) {
         throw new ServiceException("å…¬å¼å¿«ç…§æ ¼å¼é”™è¯¯");
     }
 }

 4.1 ç»“ç®—å•çº§åˆ«å…¬å¼å¿«ç…§ï¼ˆformula_snapshotï¼‰

 Schema ç‰ˆæœ¬: v1.0ï¼ˆåç»­å‡çº§éœ€å…¼å®¹æ—§ç‰ˆæœ¬ï¼‰

 {
   "version": "1.0",
   "calculatedAt": "2024-01-15T10:30:00",
   "calculatedBy": "admin",
   "calculatedByName": "ç®¡ç†å‘˜",

   "advance": {
     "type": 1,
     "typeName": "è‡ªæœ‰èµ„é‡‘",
     "principal": 1000000.00,
     "principalBase": "å«ç¨é‡‘é¢",
     "startDate": "2024-01-01",
     "endDate": "2024-01-31",
     "days": 30,
     "daysCalcMethod": "nature",
     "inclusive": false,
     "rateAnnual": 0.18,
     "rateDaily": 0.000493,
     "rateSource": "INTEREST_RATE_SELF",
     "interest": 14794.52,
     "formula": "1000000.00 Ã— 0.000493 Ã— 30 = 14794.52"
   },

   "channelFee": {
     "enabled": true,
     "principal": 1000000.00,
     "rate": 0.0001,
     "days": 30,
     "amount": 3000.00,
     "formula": "1000000.00 Ã— 0.0001 Ã— 30 = 3000.00"
   },

   "subsidy": {
     "enabled": false,
     "rate": 0,
     "amount": 0
   },

   "expenses": {
     "shipping": 25000.00,
     "port": 5000.00,
     "storage": 3000.00,
     "processing": 10000.00,
     "handling": 2000.00,
     "other": 0,
     "total": 45000.00
   },

   "summary": {
     "salesAmount": 1200000.00,
     "purchaseAmount": 1000000.00,
     "grossProfit": 200000.00,
     "expenseTotal": 45000.00,
     "interestTotal": 14794.52,
     "channelFeeTotal": 3000.00,
     "netProfit": 137205.48,
     "profitRate": 0.1143
   }
 }

 4.2 è´¹ç”¨æ˜ç»†çº§åˆ«å…¬å¼å¿«ç…§

 {
   "version": "1.0",
   "calculatedAt": "2024-01-15T10:30:00",
   "expenseType": 1,
   "expenseTypeName": "èˆ¹è¿è´¹",
   "qty": 500.000,
   "qtyUnit": "å¨",
   "unitPrice": 50.00,
   "priceUnit": "å…ƒ/å¨",
   "days": null,
   "taxRate": 9.00,
   "formula": "500.000 å¨ Ã— 50.00 å…ƒ/å¨ = 25000.00 å…ƒ",
   "amount": 25000.00,
   "taxAmount": 2252.25,
   "amountWithoutTax": 22747.75
 }

 ---
 äº”ã€åç«¯æ‰©å±•å®ç°

> [!bug] âš™ï¸ åç«¯å¼€å‘è¦ç‚¹
> **Entity æ‰©å±•**ï¼š
> - `FinancialSettlement.java` - æ–°å¢12ä¸ªå«èµ„ç›¸å…³å­—æ®µ
> - `FinancialSettlementExpense.java` - æ–°å»ºè´¹ç”¨æ˜ç»†å®ä½“
> - `FinancialExpenseConfig.java` - æ–°å»ºé…ç½®å®ä½“
>
> **æ ¸å¿ƒ Service**ï¼š
> - `ExpenseCalculationEngine` - è®¡ç®—å¼•æ“ï¼ˆåˆ©æ¯/é€šé“è´¹/è´´æ¯ï¼‰
> - `FinancialSettlementService` - æ‰©å±•ä¿å­˜/æŸ¥è¯¢/è®¡ç®—æ–¹æ³•
>
> **å…³é”®é€»è¾‘**ï¼š
> - seq_no è‡ªåŠ¨ç”Ÿæˆï¼ˆåŒç±»å‹é€’å¢ï¼‰
> - è´¹ç”¨æ˜ç»†ä¿å­˜ï¼šåˆ é™¤æ—§æ•°æ® â†’ æ‰¹é‡æ’å…¥ â†’ æ±‡æ€»æ›´æ–°ä¸»è¡¨
> - é…ç½®å–å‚ä¼˜å…ˆçº§ï¼šæŒ‡å®šå•†æˆ· > å…¨å±€é…ç½® > å¼‚å¸¸
> - å…¬å¼å¿«ç…§ç”Ÿæˆï¼šè®¡ç®—æ—¶è‡ªåŠ¨ç”ŸæˆJSON
>
> **MapStruct è‡ªåŠ¨è½¬æ¢**ï¼š
> - Entity â†” Bo â†” Vo è‡ªåŠ¨æ˜ å°„ï¼ˆ@AutoMapperï¼‰

 5.1 Entity æ‰©å±•

 æ–‡ä»¶: FinancialSettlement.java

 @Data
 @EqualsAndHashCode(callSuper = true)
 @TableName("financial_settlement")
 public class FinancialSettlement extends BaseFinancialSettlement {

     // ==========================================
     // å«èµ„ç›¸å…³å­—æ®µï¼ˆæ–°å¢ï¼‰
     // ==========================================

     /** å«èµ„ç±»å‹ï¼š0=æ— å«èµ„ 1=è‡ªæœ‰èµ„é‡‘ 2=é“¶è¡Œå«èµ„ */
     private Integer advanceType;

     /** å«èµ„é‡‘é¢ */
     private BigDecimal advanceAmount;

     /** è®¡æ¯å¼€å§‹æ—¥ */
     @JsonFormat(pattern = "yyyy-MM-dd")
     private LocalDate advanceStartDate;

     /** è®¡æ¯ç»“æŸæ—¥ */
     @JsonFormat(pattern = "yyyy-MM-dd")
     private LocalDate advanceEndDate;

     /** å«èµ„å¤©æ•° */
     private Integer advanceDays;

     /** æ—¥åˆ©ç‡å¿«ç…§ */
     private BigDecimal interestRate;

     /** åˆ©æ¯é‡‘é¢ */
     private BigDecimal interestAmount;

     /** é€šé“è´¹ç‡å¿«ç…§ */
     private BigDecimal channelFeeRate;

     /** é€šé“è´¹é‡‘é¢ */
     private BigDecimal channelFeeAmount;

     /** è´´æ¯æ¯”ä¾‹å¿«ç…§ */
     private BigDecimal subsidyRate;

     /** è´´æ¯é‡‘é¢ */
     private BigDecimal subsidyAmount;

     /** è´¹ç”¨æ˜ç»†åˆè®¡ */
     private BigDecimal totalExpenseAmount;

     /** å…¬å¼å¿«ç…§ï¼ˆJSONï¼‰ */
     private String formulaSnapshot;
 }

 5.2 BO æ‰©å±•

 æ–‡ä»¶: FinancialSettlementBo.java

 @Data
 @EqualsAndHashCode(callSuper = true)
 @AutoMapper(target = FinancialSettlement.class)
 public class FinancialSettlementBo extends BaseFinancialSettlementBo<FinancialSettlementDetailBo> {

     @ExcelProperty(value = "è¡Œå·")
     private String crown;

     // ==========================================
     // å«èµ„ç›¸å…³å­—æ®µ
     // ==========================================

     @ExcelProperty(value = "å«èµ„ç±»å‹", converter = ExcelDictConvert.class)
     @ExcelDictFormat(dictType = "erp_advance_type")
     private Integer advanceType;

     @ExcelProperty(value = "å«èµ„é‡‘é¢")
     private BigDecimal advanceAmount;

     @ExcelProperty(value = "è®¡æ¯å¼€å§‹æ—¥")
     private LocalDate advanceStartDate;

     @ExcelProperty(value = "è®¡æ¯ç»“æŸæ—¥")
     private LocalDate advanceEndDate;

     @ExcelProperty(value = "å«èµ„å¤©æ•°")
     private Integer advanceDays;

     @ExcelProperty(value = "æ—¥åˆ©ç‡")
     private BigDecimal interestRate;

     @ExcelProperty(value = "åˆ©æ¯é‡‘é¢")
     private BigDecimal interestAmount;

     private BigDecimal channelFeeRate;
     private BigDecimal channelFeeAmount;
     private BigDecimal subsidyRate;
     private BigDecimal subsidyAmount;
     private BigDecimal totalExpenseAmount;
     private String formulaSnapshot;

     // ==========================================
     // è´¹ç”¨æ˜ç»†åˆ—è¡¨
     // ==========================================

     /** è´¹ç”¨æ˜ç»†åˆ—è¡¨ */
     @TableField(exist = false)
     private List<FinancialSettlementExpenseBo> expenseList;
 }

 5.3 è´¹ç”¨è®¡ç®—å¼•æ“

 æ–‡ä»¶: ExpenseCalculationEngine.java

 @Service
 @RequiredArgsConstructor
 public class ExpenseCalculationEngine {

     private final FinancialExpenseConfigMapper expenseConfigMapper;

     /**
      * è®¡ç®—å«èµ„åˆ©æ¯
      *
      * @param principal    æœ¬é‡‘
      * @param startDate    å¼€å§‹æ—¥æœŸ
      * @param endDate      ç»“æŸæ—¥æœŸ
      * @param advanceType  å«èµ„ç±»å‹
      * @return è®¡ç®—ç»“æœ
      */
     public AdvanceInterestResult calculateInterest(
             BigDecimal principal,
             LocalDate startDate,
             LocalDate endDate,
             Integer advanceType
     ) {
         // 1. æŸ¥è¯¢åˆ©ç‡é…ç½®
         String configCode = advanceType == 1 ? "INTEREST_RATE_SELF" : "INTEREST_RATE_BANK";
         FinancialExpenseConfig config = getEffectiveConfig(configCode, startDate);

         if (config == null) {
             throw new ServiceException("æœªæ‰¾åˆ°æœ‰æ•ˆçš„åˆ©ç‡é…ç½®ï¼š" + configCode);
         }

         // 2. è®¡ç®—å¤©æ•°
         long days = ChronoUnit.DAYS.between(startDate, endDate);
         if (days <= 0) {
             return new AdvanceInterestResult(BigDecimal.ZERO, 0, BigDecimal.ZERO, "å¤©æ•°ä¸º0ï¼Œæ— éœ€è®¡ç®—");
         }

         // 3. è·å–æ—¥åˆ©ç‡
         BigDecimal dailyRate = getDailyRate(config);

         // 4. åº”ç”¨é˜¶æ¢¯è§„åˆ™ï¼ˆå¦‚æœ‰ï¼‰
         BigDecimal interest;
         String formula;
         if (StringUtils.isNotBlank(config.getTierRules())) {
             // é˜¶æ¢¯è®¡ç®—
             TierCalculationResult tierResult = calculateWithTiers(principal, days, config.getTierRules());
             interest = tierResult.getInterest();
             formula = tierResult.getFormula();
         } else {
             // ç®€å•è®¡ç®—
             interest = principal.multiply(dailyRate).multiply(BigDecimal.valueOf(days));
             formula = String.format("%s Ã— %s Ã— %d = %s",
                 formatAmount(principal), formatRate(dailyRate), days, formatAmount(interest));
         }

         // 5. æ„å»ºå…¬å¼å¿«ç…§
         String snapshot = buildInterestSnapshot(principal, dailyRate, days, interest, config);

         return new AdvanceInterestResult(interest, (int) days, dailyRate, snapshot);
     }

     /**
      * è®¡ç®—ç‰©æµè´¹ç”¨
      */
     public ExpenseResult calculateExpense(
             Integer expenseType,
             BigDecimal qty,
             Integer days,
             BigDecimal unitPrice
     ) {
         BigDecimal amount;
         String formula;

         if (days != null && days > 0) {
             // ä»“å‚¨è´¹ï¼šå•ä»· Ã— æ•°é‡ Ã— å¤©æ•°
             amount = unitPrice.multiply(qty).multiply(BigDecimal.valueOf(days));
             formula = String.format("%så…ƒ/å¨/å¤© Ã— %så¨ Ã— %då¤© = %så…ƒ",
                 formatAmount(unitPrice), formatQty(qty), days, formatAmount(amount));
         } else {
             // å…¶ä»–è´¹ç”¨ï¼šå•ä»· Ã— æ•°é‡
             amount = unitPrice.multiply(qty);
             formula = String.format("%så…ƒ/å¨ Ã— %så¨ = %så…ƒ",
                 formatAmount(unitPrice), formatQty(qty), formatAmount(amount));
         }

         String snapshot = buildExpenseSnapshot(expenseType, qty, unitPrice, days, amount, formula);
         return new ExpenseResult(amount, snapshot);
     }

     // ... å…¶ä»–è¾…åŠ©æ–¹æ³•
 }

 5.4 Service æ‰©å±•

 æ–‡ä»¶: FinancialSettlementService.java æ–°å¢æ–¹æ³•

 /**
  * è®¡ç®—å«èµ„åˆ©æ¯ï¼ˆå‰ç«¯ç‚¹å‡»"è®¡ç®—"æŒ‰é’®è°ƒç”¨ï¼‰
  */
 public FinancialSettlementVo calculateAdvanceInterest(FinancialSettlementBo bo) {
     // å‚æ•°æ ¡éªŒ
     if (bo.getAdvanceType() == null || bo.getAdvanceType() == 0) {
         throw new ServiceException("å«èµ„ç±»å‹ä¸èƒ½ä¸ºç©º");
     }
     if (bo.getAdvanceAmount() == null || bo.getAdvanceAmount().compareTo(BigDecimal.ZERO) <= 0) {
         throw new ServiceException("å«èµ„é‡‘é¢å¿…é¡»å¤§äº0");
     }
     if (bo.getAdvanceStartDate() == null || bo.getAdvanceEndDate() == null) {
         throw new ServiceException("è®¡æ¯æ—¥æœŸä¸èƒ½ä¸ºç©º");
     }
     if (bo.getAdvanceStartDate().isAfter(bo.getAdvanceEndDate())) {
         throw new ServiceException("è®¡æ¯å¼€å§‹æ—¥ä¸èƒ½æ™šäºç»“æŸæ—¥");
     }

     // è°ƒç”¨è®¡ç®—å¼•æ“
     AdvanceInterestResult result = expenseCalculationEngine.calculateInterest(
         bo.getAdvanceAmount(),
         bo.getAdvanceStartDate(),
         bo.getAdvanceEndDate(),
         bo.getAdvanceType()
     );

     // å›å¡«ç»“æœ
     bo.setAdvanceDays(result.getDays());
     bo.setInterestRate(result.getDailyRate());
     bo.setInterestAmount(result.getInterest());
     bo.setFormulaSnapshot(result.getSnapshot());

     return MapstructUtils.convert(bo, FinancialSettlementVo.class);
 }

 /**
  * ä¿å­˜è´¹ç”¨æ˜ç»†
  */
 @Transactional
 public void saveExpenseList(Long settlementId, List<FinancialSettlementExpenseBo> expenseList) {
     // 1. åˆ é™¤åŸæœ‰è´¹ç”¨æ˜ç»†
     expenseMapper.delete(Wrappers.<FinancialSettlementExpense>lambdaQuery()
         .eq(FinancialSettlementExpense::getPid, settlementId));

     // 2. æ‰¹é‡æ’å…¥æ–°è´¹ç”¨
     if (CollUtil.isNotEmpty(expenseList)) {
         List<FinancialSettlementExpense> entities = expenseList.stream()
             .map(bo -> {
                 FinancialSettlementExpense entity = MapstructUtils.convert(bo, FinancialSettlementExpense.class);
                 entity.setPid(settlementId);
                 return entity;
             })
             .collect(Collectors.toList());

         expenseMapper.insertBatch(entities);

         // 3. æ›´æ–°ç»“ç®—å•çš„è´¹ç”¨åˆè®¡
         BigDecimal totalExpense = expenseList.stream()
             .map(FinancialSettlementExpenseBo::getAmount)
             .filter(Objects::nonNull)
             .reduce(BigDecimal.ZERO, BigDecimal::add);

         financialSettlementMapper.update(null, Wrappers.<FinancialSettlement>lambdaUpdate()
             .eq(FinancialSettlement::getId, settlementId)
             .set(FinancialSettlement::getTotalExpenseAmount, totalExpense));
     }
 }

 5.5 Controller æ‰©å±•

 /**
  * è®¡ç®—å«èµ„åˆ©æ¯
  */
 @PostMapping("/calculateInterest")
 @SaCheckPermission("financial:settlement:edit")
 @Log(title = "ç»“ç®—å•-è®¡ç®—åˆ©æ¯", businessType = BusinessType.UPDATE)
 public R<FinancialSettlementVo> calculateInterest(@Validated @RequestBody FinancialSettlementBo bo) {
     return R.ok(financialSettlementService.calculateAdvanceInterest(bo));
 }

 /**
  * ä¿å­˜è´¹ç”¨æ˜ç»†
  */
 @PostMapping("/{id}/expense")
 @SaCheckPermission("financial:settlement:edit")
 @Log(title = "ç»“ç®—å•-ä¿å­˜è´¹ç”¨", businessType = BusinessType.UPDATE)
 public R<Void> saveExpense(
         @PathVariable Long id,
         @RequestBody List<FinancialSettlementExpenseBo> expenseList
 ) {
     financialSettlementService.saveExpenseList(id, expenseList);
     return R.ok();
 }

 /**
  * æŸ¥è¯¢è´¹ç”¨æ˜ç»†
  */
 @GetMapping("/{id}/expense")
 @SaCheckPermission("financial:settlement:query")
 public R<List<FinancialSettlementExpenseVo>> getExpenseList(@PathVariable Long id) {
     return R.ok(financialSettlementService.queryExpenseList(id));
 }

 ---
 å…­ã€å®¡æ‰¹æµé›†æˆ

> [!info] ğŸ”„ å®¡æ‰¹æµå…³é”®ç‚¹
> **çŠ¶æ€æµè½¬**ï¼š
> ```
> è‰ç¨¿(0) --æäº¤--> å¾…å®¡æ‰¹(1) --é€šè¿‡--> å·²å®Œæˆ(2)
>              |--é©³å›--> è‰ç¨¿(0)
>              |--æ’¤é”€--> è‰ç¨¿(0)
> ```
>
> **æäº¤æ ¡éªŒ**ï¼š
> - å¿…é¡»å…ˆè®¡ç®—åˆ©æ¯å’Œè´¹ç”¨ï¼ˆç¡®ä¿ `formula_snapshot` å·²ç”Ÿæˆï¼‰
> - å¦åˆ™æ‹’ç»ï¼š`"è¯·å…ˆè®¡ç®—åˆ©æ¯å’Œè´¹ç”¨åå†æäº¤å®¡æ‰¹"`
>
> **æµç¨‹ç›‘å¬**ï¼š
> - æäº¤æ—¶ï¼šé”å®šå…¬å¼å¿«ç…§ï¼Œè®¾ç½®çŠ¶æ€ä¸º WAITING
> - å®¡æ‰¹å®Œæˆï¼šè®¾ç½®çŠ¶æ€ä¸º FINISHï¼Œè§¦å‘åç»­ä¸šåŠ¡
> - å·²æäº¤åï¼šä¸å¯ç¼–è¾‘

 6.1 æµç¨‹ä»£ç 

 ä¿æŒç°æœ‰å‘½åè§„èŒƒï¼šfinancial_settlement

 6.2 æµç¨‹å˜é‡æ‰©å±•

 åœ¨æµç¨‹æäº¤æ—¶ï¼Œå°†å«èµ„ç›¸å…³å­—æ®µä½œä¸ºæµç¨‹å˜é‡ï¼š

 @EventListener(condition = "#processEvent.flowCode.startsWith('financial_settlement')")
 public void processHandler(ProcessEvent processEvent) {
     FinancialSettlement settlement = financialSettlementMapper.selectById(
         Long.valueOf(processEvent.getBusinessId())
     );

     // æäº¤æ—¶é”å®šå…¬å¼å¿«ç…§
     if (processEvent.getSubmit()) {
         // ç¡®ä¿å…¬å¼å¿«ç…§å·²ç”Ÿæˆ
         if (StringUtils.isBlank(settlement.getFormulaSnapshot())) {
             throw new ServiceException("è¯·å…ˆè®¡ç®—åˆ©æ¯å’Œè´¹ç”¨åå†æäº¤å®¡æ‰¹");
         }
         settlement.setCheckedStatus(BusinessStatusEnum.WAITING.getCode());
     }

     // å®¡æ‰¹å®Œæˆåçš„å¤„ç†
     if (BusinessStatusEnum.FINISH.getStatus().equals(processEvent.getStatus())) {
         settlement.setCheckedStatus(BusinessStatusEnum.FINISH.getCode());
         // è§¦å‘åç»­ä¸šåŠ¡ï¼ˆå¦‚æ›´æ–°å•†æˆ·ä½™é¢ç­‰ï¼‰
         afterApproveFunc(settlement);
     }

     financialSettlementMapper.updateById(settlement);
 }

 6.3 çŠ¶æ€æµè½¬

 è‰ç¨¿(0) --æäº¤--> å¾…å®¡æ‰¹(1) --å®¡æ‰¹é€šè¿‡--> å·²å®Œæˆ(2)
                       |
                       +--é©³å›--> è‰ç¨¿(0)
                       |
                       +--æ’¤é”€--> è‰ç¨¿(0)

 ---
 ä¸ƒã€å®æ–½è½åœ°é¡ºåº

> [!warning] âš ï¸ å®æ–½è·¯çº¿å›¾
> **Phase 0: å£å¾„å†»ç»“ï¼ˆå‰ç½®æ¡ä»¶ï¼‰** - ğŸš« ä¸å†»ç»“ä¸å¼€å‘
> - å«èµ„åˆ©æ¯å£å¾„ç¡®è®¤
> - ç‰©æµè´¹ç”¨å£å¾„ç¡®è®¤
> - ä¸ç°æœ‰è¡¨å…³ç³»ç¡®è®¤
>
> **Phase 1: æ•°æ®åº“è¿ç§»**
> - æ‰©å±•ä¸»è¡¨ + æ–°å»º2å¼ è¡¨ + åˆå§‹åŒ–å­—å…¸ + åˆå§‹åŒ–é»˜è®¤è´¹ç‡
>
> **Phase 2: åç«¯å¼€å‘**
> - Entity/Bo/Voæ‰©å±• â†’ Serviceè®¡ç®—å¼•æ“ â†’ Controlleræ¥å£
>
> **Phase 3: å‰ç«¯å¼€å‘**
> - æ–°å»ºç¼–è¾‘é¡µï¼ˆFlexEditå¸ƒå±€ï¼‰ â†’ APIæ‰©å±• â†’ æƒé™é…ç½®
>
> **Phase 4: å®¡æ‰¹æµè”åŠ¨**
> - æµç¨‹æäº¤æ ¡éªŒ â†’ çŠ¶æ€æµè½¬éªŒè¯
>
> **Phase 5: æµ‹è¯•å›å½’**
> - è®¡ç®—å‡†ç¡®æ€§ + è¾¹ç•Œæµ‹è¯• + å¹¶å‘æµ‹è¯• + ç§Ÿæˆ·éš”ç¦»

 Phase 0: å£å¾„å†»ç»“ï¼ˆå‰ç½®æ¡ä»¶ - é˜»å¡åç»­ï¼‰

 âš ï¸ ä¸å†»ç»“å£å¾„ï¼Œä¸å¼€å§‹å¼€å‘

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚        å¾…å†»ç»“é¡¹        â”‚ è´Ÿè´£äºº â”‚        çŠ¶æ€         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å«èµ„åˆ©æ¯å£å¾„ï¼ˆè§ 0.1ï¼‰ â”‚ ç”¨æˆ·   â”‚ å¾…ç¡®è®¤              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ ç‰©æµè´¹ç”¨å£å¾„ï¼ˆè§ 0.2ï¼‰ â”‚ ç”¨æˆ·   â”‚ å¾…ç¡®è®¤              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ ä¸ç°æœ‰è¡¨å…³ç³»ï¼ˆè§ 0.3ï¼‰ â”‚ ç”¨æˆ·   â”‚ å¾…ç¡®è®¤ï¼ˆæ¨èæ–¹æ¡ˆBï¼‰ â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 äº¤ä»˜ç‰©ï¼š
 - å£å¾„ç¡®è®¤è¡¨ï¼ˆå«æ‰€æœ‰å‚æ•°å–å€¼ï¼‰
 - éªŒæ”¶ç®—ä¾‹ 3-5 ä¸ªï¼ˆç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•ï¼‰

 ---
 Phase 1: æ•°æ®åº“è¿ç§»

 ä»»åŠ¡æ¸…å•ï¼š

 1. æ‰©å±•ä¸»è¡¨ financial_settlement
 -- æ‰§è¡Œ V1.0.0__extend_settlement.sql
 ALTER TABLE financial_settlement ADD COLUMN advance_type SMALLINT DEFAULT 0;
 ALTER TABLE financial_settlement ADD COLUMN advance_amount NUMERIC(18,2);
 -- ... å…¶ä»–å­—æ®µ
 2. æ–°å»ºè´¹ç”¨æ˜ç»†è¡¨ financial_settlement_expense
 -- æ‰§è¡Œ V1.0.1__create_expense_table.sql
 CREATE TABLE financial_settlement_expense (...);
 3. æ–°å»ºè´¹ç”¨é…ç½®è¡¨ financial_expense_config
 -- æ‰§è¡Œ V1.0.2__create_config_table.sql
 CREATE TABLE financial_expense_config (...);
 4. åˆå§‹åŒ–å­—å…¸æ•°æ®
 -- æ‰§è¡Œ V1.0.3__init_dict.sql
 INSERT INTO sys_dict_type ... (erp_advance_type, erp_expense_type, erp_base_type)
 5. åˆå§‹åŒ–é»˜è®¤è´¹ç‡é…ç½®
 -- è‡ªæœ‰èµ„é‡‘å«èµ„åˆ©ç‡ï¼š18%å¹´åŒ–ï¼ŒåŸºæ•°=å«ç¨é‡‘é¢ï¼ŒæŒ‰å¤©Ã—è´¹ç‡è®¡ç®—
 INSERT INTO financial_expense_config
   (config_code, config_name, config_type, rate_value, rate_unit, base_type, calc_method, effective_date, status,
 tenant_id)
 VALUES
   ('INTEREST_RATE_SELF', 'è‡ªæœ‰èµ„é‡‘å«èµ„åˆ©ç‡', 1, 0.18, 'year', 1, 1, '2024-01-01', 1, '000000');

 -- é“¶è¡Œå«èµ„åˆ©ç‡ï¼ˆå¦‚éœ€åŒºåˆ†ï¼‰
 INSERT INTO financial_expense_config
   (config_code, config_name, config_type, rate_value, rate_unit, base_type, calc_method, effective_date, status,
 tenant_id)
 VALUES
   ('INTEREST_RATE_BANK', 'é“¶è¡Œå«èµ„åˆ©ç‡', 1, 0.12, 'year', 1, 1, '2024-01-01', 1, '000000');

 -- é€šé“è´¹ï¼š0.5å…ƒ/å¨/å¤©ï¼Œ30å¤©å…è´¹æœŸï¼ŒæŒ‰é˜¶æ¢¯æ­¥è¿›
 INSERT INTO financial_expense_config
   (config_code, config_name, config_type, rate_value, rate_unit, base_type, calc_method, tier_rules, effective_date,
  status, tenant_id)
 VALUES
   ('CHANNEL_FEE', 'é€šé“è´¹', 2, 0.5, 'day', 3, 2,
    '[{"minDays":0,"maxDays":30,"rate":0},{"minDays":31,"maxDays":9999,"rate":0.5}]',
    '2024-01-01', 1, '000000');

 -- è´´æ¯ç‡ï¼š2.3%å¹´åŒ–ï¼ŒæŒ‰360å¤©åŸºå‡†
 INSERT INTO financial_expense_config
   (config_code, config_name, config_type, rate_value, rate_unit, base_type, calc_method, effective_date, status,
 tenant_id)
 VALUES
   ('SUBSIDY_RATE', 'è´´æ¯ç‡', 3, 0.023, 'year', 1, 1, '2024-01-01', 1, '000000');

 6. å­—æ®µè¯´æ˜ï¼š
 | å­—æ®µ        | å–å€¼                                   | è¯´æ˜     |
 |-------------|----------------------------------------|----------|
 | config_type | 1=å«èµ„åˆ©ç‡, 2=é€šé“è´¹, 3=è´´æ¯, 4=ç‰©æµè´¹ | é…ç½®ç±»å‹ |
 | rate_unit   | year=å¹´åŒ–, month=æœˆ, day=æ—¥            | è´¹ç‡å•ä½ |
 | base_type   | 1=å«ç¨é‡‘é¢, 2=ä¸å«ç¨é‡‘é¢, 3=æ•°é‡(å¨)   | è®¡ç®—åŸºæ•° |
 | calc_method | 1=æŒ‰å¤©Ã—è´¹ç‡, 2=é˜¶æ¢¯æ­¥è¿›, 3=å›ºå®šé‡‘é¢    | è®¡ç®—æ–¹å¼ |


 ---
 Phase 2: åç«¯å¼€å‘

 ä»»åŠ¡æ¸…å•ï¼š

 7. Entity æ‰©å±• (FinancialSettlement.java)
   - æ·»åŠ å«èµ„ç›¸å…³å­—æ®µï¼ˆadvanceType, advanceAmount, advanceDays, interestAmount ç­‰ï¼‰
   - æ·»åŠ å…¬å¼å¿«ç…§å­—æ®µ formulaSnapshot
 2. æ–°å»º Entity (FinancialSettlementExpense.java)
   - ç»§æ‰¿ TenantEntity
   - å­—æ®µï¼špid, expenseType, expenseName, seqNo, qty, unitPrice, days, amount, taxRate, taxAmount, amountWithoutTax,
 sourceDocType, sourceDocNo, sourceDocId, formulaSnapshot, remark
   - seqNo ç”±åç«¯è‡ªåŠ¨ç”Ÿæˆï¼ˆåŒç±»å‹é€’å¢ï¼‰
 3. æ–°å»º Entity (FinancialExpenseConfig.java)
   - è´¹ç‡é…ç½®å®ä½“
 4. Bo/Vo æ‰©å±•
   - FinancialSettlementBo æ·»åŠ  expenseList å­—æ®µ
   - FinancialSettlementVo æ·»åŠ å¯¹åº”å±•ç¤ºå­—æ®µ
 5. Mapper æ–°å¢
   - FinancialSettlementExpenseMapper ç»§æ‰¿ BaseMapperPlus
   - FinancialExpenseConfigMapper ç»§æ‰¿ BaseMapperPlus
 6. Service æ‰©å±• (FinancialSettlementService.java)
   - æ‰©å±• insertByBo/updateByBo å¤„ç†è´¹ç”¨æ˜ç»†
   - æ‰©å±• queryById æŸ¥è¯¢è´¹ç”¨æ˜ç»†
   - æ–°å¢ calculateAdvanceInterest æ–¹æ³•
   - æ–°å¢ validateBeforeSubmit æ–¹æ³•
 7. æ–°å»º Service (ExpenseCalculationEngine.java)
   - åˆ©æ¯è®¡ç®—é€»è¾‘
   - é€šé“è´¹è®¡ç®—é€»è¾‘
   - è´´æ¯è®¡ç®—é€»è¾‘
   - å…¬å¼å¿«ç…§ç”Ÿæˆ
 8. Controller æ‰©å±• (FinancialSettlementController.java)
   - POST /calculateInterest - è®¡ç®—åˆ©æ¯
   - GET /{id}/expense - æŸ¥è¯¢è´¹ç”¨æ˜ç»†
   - POST /{id}/expense - ä¿å­˜è´¹ç”¨æ˜ç»†

 ---
 Phase 3: å‰ç«¯å¼€å‘

 ä»»åŠ¡æ¸…å•ï¼š

 1. API æ‰©å±• (api/supplychain/financial/settlement.ts)
 export function calculateInterest(data) { ... }
 export function getExpenseList(id) { ... }
 export function saveExpenseList(id, data) { ... }
 2. æ–°å»º API (api/supplychain/financial/settlementExpense.ts)
 // è´¹ç”¨æ˜ç»†ç‹¬ç«‹ APIï¼ˆå¦‚éœ€è¦ï¼‰
 3. æ–°å»ºç¼–è¾‘é¡µ (views/supplychain/financial/settlement/edit.vue)
   - å‚è€ƒ payment/edit.vue å¸ƒå±€
   - FlexEdit ä¸Šä¸‹åˆ†å‰²
   - ä¸Šéƒ¨ï¼šåŸºæœ¬ä¿¡æ¯ + å«èµ„ä¿¡æ¯ + è®¡ç®—æŒ‰é’®
   - ä¸‹éƒ¨ï¼šTab åˆ‡æ¢ï¼ˆå•†å“æ˜ç»† / è´¹ç”¨æ˜ç»†ï¼‰
   - åº•éƒ¨ï¼šFooterButton
 4. åˆ—è¡¨é¡µæ‰©å±• (views/supplychain/financial/settlement/index.vue)
   - æ·»åŠ "æ–°å¢"æŒ‰é’®ï¼ˆè·³è½¬ edit é¡µï¼‰
   - æ·»åŠ "ç¼–è¾‘"æ“ä½œåˆ—
 5. æƒé™/èœå•é…ç½®
   - åœ¨ç³»ç»Ÿç®¡ç† â†’ èœå•ç®¡ç†ä¸­æ·»åŠ ç¼–è¾‘é¡µèœå•
   - é…ç½®æƒé™ï¼šfinancial:settlement:add/edit/remove

 ---
 Phase 4: å®¡æ‰¹æµè”åŠ¨

 ä»»åŠ¡æ¸…å•ï¼š

 1. æµç¨‹æäº¤æ ¡éªŒ
   - åœ¨ ProcessEvent ç›‘å¬å™¨ä¸­è°ƒç”¨ validateBeforeSubmit
   - ç¡®ä¿å…¬å¼å¿«ç…§å·²ç”Ÿæˆ
 2. çŠ¶æ€æµè½¬éªŒè¯
   - DRAFT â†’ WAITING â†’ FINISH
   - é©³å›/æ’¤é”€ â†’ DRAFT
   - å·²æäº¤åä¸å¯ç¼–è¾‘

 ---
 Phase 5: æµ‹è¯•å›å½’

> [!check] âœ… éªŒæ”¶æµ‹è¯•æ¸…å•
> **è®¡ç®—å‡†ç¡®æ€§æµ‹è¯•ï¼ˆ3ä¸ªï¼‰**ï¼š
> - åˆ©æ¯è®¡ç®—ï¼š100ä¸‡ Ã— 18% Ã— 30å¤© = 15,000å…ƒ
> - é€šé“è´¹è®¡ç®—ï¼š500å¨ Ã— 35å¤© = 1,250å…ƒï¼ˆ5å¤©è¶…æœŸï¼‰
> - è´´æ¯è®¡ç®—ï¼š100ä¸‡ Ã— 2.3% Ã— 120å¤© = 7,666.67å…ƒ
>
> **è¾¹ç•Œæµ‹è¯•ï¼ˆ3ä¸ªï¼‰**ï¼š
> - åŒæ—¥è®¡æ¯ï¼šå¤©æ•°=0ï¼Œåˆ©æ¯=0
> - èµ·æ—¥>æ­¢æ—¥ï¼šæŠ›å‡ºå¼‚å¸¸
> - é…ç½®ç¼ºå¤±ï¼šæŠ›å‡º"æœªæ‰¾åˆ°æœ‰æ•ˆçš„è´¹ç‡é…ç½®"
>
> **ç³»ç»Ÿæµ‹è¯•ï¼ˆ4ä¸ªï¼‰**ï¼š
> - å¹¶å‘ä¿®æ”¹ï¼šåä¿å­˜è€…æ”¶åˆ°æç¤º
> - å®¡æ‰¹æµï¼šæ— å¿«ç…§æ—¶æäº¤è¢«æ‹’ç»
> - ç§Ÿæˆ·éš”ç¦»ï¼šè·¨ç§Ÿæˆ·æŸ¥è¯¢å¤±è´¥
> - é‡ç®—è¦†ç›–ï¼šå¤šæ¬¡è®¡ç®—æ­£å¸¸è¦†ç›–

 æµ‹è¯•ç”¨ä¾‹ï¼š

 1. åˆ©æ¯è®¡ç®—å‡†ç¡®æ€§
   - è¾“å…¥ï¼šå«èµ„100ä¸‡ï¼Œ18%å¹´åŒ–ï¼Œ30å¤©
   - é¢„æœŸï¼šåˆ©æ¯ 15,000 å…ƒ
 2. é€šé“è´¹è®¡ç®—å‡†ç¡®æ€§
   - è¾“å…¥ï¼š500å¨ï¼Œ35å¤©
   - é¢„æœŸï¼šé€šé“è´¹ 1,250 å…ƒï¼ˆ5å¤© Ã— 500å¨ Ã— 0.5å…ƒï¼‰
 3. è´´æ¯è®¡ç®—å‡†ç¡®æ€§
   - è¾“å…¥ï¼šæ±‡ç¥¨100ä¸‡ï¼Œ2.3%å¹´åŒ–ï¼Œ120å¤©
   - é¢„æœŸï¼šè´´æ¯ 7,666.67 å…ƒ
 4. å¹¶å‘ä¿®æ”¹æµ‹è¯•
   - ä¸¤ä¸ªç”¨æˆ·åŒæ—¶ç¼–è¾‘åŒä¸€å•æ®
   - é¢„æœŸï¼šåä¿å­˜è€…æ”¶åˆ°"æ•°æ®å·²è¢«ä¿®æ”¹"æç¤º
 5. å®¡æ‰¹æµæµ‹è¯•
   - æ— å…¬å¼å¿«ç…§æ—¶æäº¤
   - é¢„æœŸï¼šæç¤º"è¯·å…ˆè®¡ç®—åˆ©æ¯"
 6. ç§Ÿæˆ·éš”ç¦»æµ‹è¯•
   - ç§Ÿæˆ·Açš„ç»“ç®—å•ä¸èƒ½è¢«ç§Ÿæˆ·BæŸ¥è¯¢
 7. å¤©æ•°è¾¹ç•Œæµ‹è¯•
   - è¾“å…¥ï¼šåŒæ—¥ï¼ˆstartDate == endDateï¼‰
   - é¢„æœŸï¼šå¤©æ•°=0ï¼Œåˆ©æ¯=0
 8. æ—¥æœŸæ ¡éªŒæµ‹è¯•
   - è¾“å…¥ï¼šèµ·æ—¥>æ­¢æ—¥
   - é¢„æœŸï¼šæŠ›å‡º"è®¡æ¯å¼€å§‹æ—¥ä¸èƒ½æ™šäºç»“æŸæ—¥"å¼‚å¸¸
 9. é…ç½®ç¼ºå¤±æµ‹è¯•
   - è¾“å…¥ï¼šåˆ é™¤/å¤±æ•ˆ INTEREST_RATE_SELF é…ç½®
   - é¢„æœŸï¼šæŠ›å‡º"æœªæ‰¾åˆ°æœ‰æ•ˆçš„è´¹ç‡é…ç½®"å¼‚å¸¸
 10. é‡ç®—è¦†ç›–æµ‹è¯•
   - æ“ä½œï¼šå¤šæ¬¡ç‚¹å‡»"è®¡ç®—åˆ©æ¯"åä¿å­˜
   - é¢„æœŸï¼šsnapshot æ­£å¸¸è¦†ç›–ï¼Œæäº¤æ ¡éªŒé€šè¿‡

 ---
 å…«ã€å…³é”®æ–‡ä»¶æ¸…å•

> [!quote] ğŸ“¦ å¼€å‘æ–‡ä»¶æ£€æŸ¥æ¸…å•
> **åç«¯ï¼ˆJavaï¼‰**ï¼š
> - Entity: æ‰©å±•1ä¸ª + æ–°å¢2ä¸ª
> - Bo/Vo: æ‰©å±•1å¯¹ + æ–°å¢2å¯¹
> - Service: æ‰©å±•1ä¸ª + æ–°å¢1ä¸ªï¼ˆExpenseCalculationEngineï¼‰
> - Controller: æ‰©å±•1ä¸ªï¼ˆæ–°å¢3ä¸ªæ¥å£ï¼‰
>
> **å‰ç«¯ï¼ˆVueï¼‰**ï¼š
> - é¡µé¢: æ–°å¢ç¼–è¾‘é¡µ `edit.vue`
> - API: æ‰©å±•1ä¸ª + å¯é€‰æ–°å¢1ä¸ª
>
> **SQL**ï¼š
> - V1.0.0 - æ‰©å±•ç»“ç®—å•è¡¨
> - V1.0.1 - åˆ›å»ºè´¹ç”¨æ˜ç»†è¡¨
> - V1.0.2 - åˆ›å»ºé…ç½®è¡¨
> - V1.0.3 - åˆå§‹åŒ–å­—å…¸

 åç«¯
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
 â”‚    ç±»å‹    â”‚                          æ–‡ä»¶                           â”‚ æ“ä½œ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Entity     â”‚ financial/domain/entity/FinancialSettlement.java        â”‚ æ‰©å±• â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Entity     â”‚ financial/domain/entity/FinancialSettlementExpense.java â”‚ æ–°å¢ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Entity     â”‚ financial/domain/entity/FinancialExpenseConfig.java     â”‚ æ–°å¢ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Bo         â”‚ financial/domain/bo/FinancialSettlementBo.java          â”‚ æ‰©å±• â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Bo         â”‚ financial/domain/bo/FinancialSettlementExpenseBo.java   â”‚ æ–°å¢ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Vo         â”‚ financial/domain/vo/FinancialSettlementVo.java          â”‚ æ‰©å±• â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Vo         â”‚ financial/domain/vo/FinancialSettlementExpenseVo.java   â”‚ æ–°å¢ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Mapper     â”‚ financial/mapper/FinancialSettlementExpenseMapper.java  â”‚ æ–°å¢ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Service    â”‚ financial/service/FinancialSettlementService.java       â”‚ æ‰©å±• â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Service    â”‚ financial/service/ExpenseCalculationEngine.java         â”‚ æ–°å¢ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ Controller â”‚ financial/controller/FinancialSettlementController.java â”‚ æ‰©å±• â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
 å‰ç«¯
 â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
 â”‚ ç±»å‹ â”‚                      æ–‡ä»¶                       â”‚ æ“ä½œ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ é¡µé¢ â”‚ views/supplychain/financial/settlement/edit.vue â”‚ æ–°å¢ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ API  â”‚ api/supplychain/financial/settlement.ts         â”‚ æ‰©å±• â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
 â”‚ API  â”‚ api/supplychain/financial/settlementExpense.ts  â”‚ æ–°å¢ â”‚
 â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
 SQL
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚               æ–‡ä»¶               â”‚      è¯´æ˜      â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ V1.0.0__extend_settlement.sql    â”‚ æ‰©å±•ç»“ç®—å•è¡¨   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ V1.0.1__create_expense_table.sql â”‚ åˆ›å»ºè´¹ç”¨æ˜ç»†è¡¨ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ V1.0.2__create_config_table.sql  â”‚ åˆ›å»ºé…ç½®è¡¨     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ V1.0.3__init_dict.sql            â”‚ åˆå§‹åŒ–å­—å…¸     â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 ---
 ä¹ã€å¹¶å‘ä¸å¹‚ç­‰ç­–ç•¥

 9.1 å…¬å¼å¿«ç…§é”å®šæœºåˆ¶

 æ ¸å¿ƒåŸåˆ™ï¼šåç«¯æƒå¨è®¡ç®—ï¼Œå‰ç«¯ä»…å±•ç¤º

 å‰ç«¯æ“ä½œæµç¨‹ï¼š
 1. ç”¨æˆ·å¡«å†™å«èµ„ä¿¡æ¯ â†’ ç‚¹å‡»"è®¡ç®—åˆ©æ¯"æŒ‰é’®
 2. è°ƒç”¨åç«¯ /calculateInterest API â†’ åç«¯è¿”å›è®¡ç®—ç»“æœ + å…¬å¼å¿«ç…§
 3. å‰ç«¯å±•ç¤ºç»“æœï¼ˆåªè¯»ï¼‰â†’ ç”¨æˆ·ç¡®è®¤åä¿å­˜/æäº¤

 åç«¯æ ¡éªŒè§„åˆ™ï¼š
 - ä¿å­˜æ—¶ï¼šå…è®¸æ— å…¬å¼å¿«ç…§ï¼ˆè‰ç¨¿çŠ¶æ€ï¼‰
 - æäº¤å®¡æ‰¹æ—¶ï¼šå¿…é¡»æœ‰å…¬å¼å¿«ç…§ï¼Œå¦åˆ™æ‹’ç»æäº¤
 - å®¡æ‰¹é€šè¿‡åï¼šå…¬å¼å¿«ç…§ä¸å¯ä¿®æ”¹

 9.2 å®¡æ‰¹å‰æ ¡éªŒä¸é”å®š

 æ ¡éªŒæ—¶æœºï¼š æµç¨‹æäº¤å‰ï¼ˆProcessEvent.submit = trueï¼‰

 /**
  * å®¡æ‰¹å‰æ ¡éªŒ - åœ¨ processHandler ä¸­è°ƒç”¨
  */
 public void validateBeforeSubmit(FinancialSettlement settlement) {
     // 1. çŠ¶æ€æ ¡éªŒ
     if (!BusinessStatusEnum.DRAFT.getCode().equals(settlement.getCheckedStatus())) {
         throw new ServiceException("å•æ®çŠ¶æ€ä¸æ˜¯è‰ç¨¿ï¼Œæ— æ³•æäº¤");
     }

     // 2. å«èµ„ä¿¡æ¯æ ¡éªŒï¼ˆå¦‚æœ‰å«èµ„ï¼‰
     if (settlement.getAdvanceType() != null && settlement.getAdvanceType() > 0) {
         Assert.notNull(settlement.getAdvanceAmount(), "å«èµ„é‡‘é¢ä¸èƒ½ä¸ºç©º");
         Assert.notNull(settlement.getAdvanceStartDate(), "è®¡æ¯å¼€å§‹æ—¥ä¸èƒ½ä¸ºç©º");
         Assert.notNull(settlement.getAdvanceEndDate(), "è®¡æ¯ç»“æŸæ—¥ä¸èƒ½ä¸ºç©º");
         Assert.notNull(settlement.getInterestAmount(), "è¯·å…ˆç‚¹å‡»[è®¡ç®—åˆ©æ¯]æŒ‰é’®");
         Assert.notBlank(settlement.getFormulaSnapshot(), "å…¬å¼å¿«ç…§ä¸èƒ½ä¸ºç©ºï¼Œè¯·å…ˆè®¡ç®—");
     }

     // 3. å…¬å¼å¿«ç…§æ ¼å¼æ ¡éªŒ
     if (StringUtils.isNotBlank(settlement.getFormulaSnapshot())) {
         validateFormulaSnapshot(settlement.getFormulaSnapshot());
     }

     // 4. è´¹ç”¨æ˜ç»†æ ¡éªŒ
     List<FinancialSettlementExpense> expenses = expenseMapper.selectByPid(settlement.getId());
     BigDecimal expenseTotal = expenses.stream()
         .map(FinancialSettlementExpense::getAmount)
         .filter(Objects::nonNull)
         .reduce(BigDecimal.ZERO, BigDecimal::add);

     // 5. è´¹ç”¨åˆè®¡ä¸€è‡´æ€§æ ¡éªŒ
     BigDecimal settlementExpense = settlement.getTotalExpenseAmount() != null
         ? settlement.getTotalExpenseAmount() : BigDecimal.ZERO;
     if (settlementExpense.compareTo(expenseTotal) != 0) {
         throw new ServiceException("è´¹ç”¨æ˜ç»†åˆè®¡(" + expenseTotal + ")ä¸ä¸»è¡¨(" + settlementExpense +
 ")ä¸ä¸€è‡´ï¼Œè¯·é‡æ–°ä¿å­˜");
     }
 }

 /**
  * å®¡æ‰¹åé”å®š - ç¦æ­¢ç¼–è¾‘
  */
 @EventListener(condition = "#processEvent.flowCode.startsWith('financial_settlement')")
 public void processHandler(ProcessEvent processEvent) {
     FinancialSettlement settlement = baseMapper.selectById(Long.valueOf(processEvent.getBusinessId()));

     // æäº¤æ—¶æ ¡éªŒ
     if (processEvent.getSubmit()) {
         validateBeforeSubmit(settlement);
         settlement.setCheckedStatus(BusinessStatusEnum.WAITING.getCode());
     }

     // å®¡æ‰¹é€šè¿‡ï¼šé”å®š
     if (BusinessStatusEnum.FINISH.getStatus().equals(processEvent.getStatus())) {
         settlement.setCheckedStatus(BusinessStatusEnum.FINISH.getCode());
         // è§¦å‘åç»­ä¸šåŠ¡ï¼ˆå•†æˆ·ä½™é¢ã€å‘ç¥¨å…³è”ç­‰ï¼‰
         afterApproveFunc(settlement);
     }

     // é©³å›/æ’¤é”€ï¼šå›åˆ°è‰ç¨¿
     if (BusinessStatusEnum.BACK.getStatus().equals(processEvent.getStatus())
         || BusinessStatusEnum.CANCEL.getStatus().equals(processEvent.getStatus())) {
         settlement.setCheckedStatus(BusinessStatusEnum.DRAFT.getCode());
     }

     baseMapper.updateById(settlement);
 }

 ç¼–è¾‘ä¿æŠ¤ï¼šå·²æäº¤/å·²å®¡æ‰¹å•æ®ä¸å¯ç¼–è¾‘
 @Override
 public void updateByBo(FinancialSettlementBo bo) {
     FinancialSettlement entity = baseMapper.selectById(bo.getId());

     // åªæœ‰è‰ç¨¿çŠ¶æ€å¯ç¼–è¾‘
     if (!BusinessStatusEnum.DRAFT.getCode().equals(entity.getCheckedStatus())) {
         throw new ServiceException("å•æ®å·²æäº¤å®¡æ‰¹ï¼Œä¸å…è®¸ç¼–è¾‘");
     }

     // ... æ­£å¸¸æ›´æ–°é€»è¾‘
 }

 @Override
 public void deleteByIds(Collection<Long> ids) {
     // æ ¡éªŒæ‰€æœ‰å•æ®éƒ½æ˜¯è‰ç¨¿çŠ¶æ€
     List<FinancialSettlement> list = baseMapper.selectBatchIds(ids);
     for (FinancialSettlement settlement : list) {
         if (!BusinessStatusEnum.DRAFT.getCode().equals(settlement.getCheckedStatus())) {
             throw new ServiceException("å•æ®[" + settlement.getDocNo() + "]å·²æäº¤ï¼Œä¸å…è®¸åˆ é™¤");
         }
     }

     // ... æ­£å¸¸åˆ é™¤é€»è¾‘
 }

 9.3 å¹¶å‘ä¿å­˜å¹‚ç­‰

 å¹¶å‘æ§åˆ¶æ–¹æ¡ˆï¼šçŠ¶æ€ + updateTime æ ¡éªŒ

 å†³ç­–ï¼šå½“å‰æ¡†æ¶ BaseEntity æ—  version å­—æ®µï¼Œé‡‡ç”¨çŠ¶æ€+æ—¶é—´æˆ³æ ¡éªŒ

 å‰åç«¯ updateTime ä¼ é€’ï¼š
 // å‰ç«¯ï¼šæŸ¥è¯¢æ—¶ä¿å­˜ updateTime
 const form = ref<SettlementForm>({
   id: undefined,
   updateTime: undefined,  // ä¿å­˜æŸ¥è¯¢æ—¶çš„ updateTime
   // ... å…¶ä»–å­—æ®µ
 });

 // æŸ¥è¯¢è¯¦æƒ…æ—¶ä¿å­˜
 const getDetail = async (id: number) => {
   const res = await getSettlement(id);
   form.value = res.data;
   form.value.updateTime = res.data.updateTime;  // ä¿å­˜æ—¶é—´æˆ³
 };

 // æäº¤æ—¶ä¼ å›
 const submitForm = async () => {
   await updateSettlement({
     ...form.value,
     updateTime: form.value.updateTime  // ä¼ å›æ—¶é—´æˆ³
   });
 };

 åç«¯æ ¡éªŒï¼š
 @Transactional
 public void updateByBo(FinancialSettlementBo bo) {
     FinancialSettlement entity = baseMapper.selectById(bo.getId());

     // 1. çŠ¶æ€æ ¡éªŒï¼šåªæœ‰è‰ç¨¿çŠ¶æ€å¯ä¿®æ”¹
     if (!BusinessStatusEnum.DRAFT.getCode().equals(entity.getCheckedStatus())) {
         throw new ServiceException("å•æ®å·²æäº¤å®¡æ‰¹ï¼Œä¸å…è®¸ä¿®æ”¹");
     }

     // 2. æ—¶é—´æˆ³æ ¡éªŒï¼šå‰ç«¯ä¼ å› updateTimeï¼Œä¸æ•°æ®åº“æ¯”å¯¹
     if (bo.getUpdateTime() != null && entity.getUpdateTime() != null) {
         // æ¯”è¾ƒåˆ°ç§’çº§ï¼ˆé¿å…æ¯«ç§’ç²¾åº¦é—®é¢˜ï¼‰
         long boTime = bo.getUpdateTime().getTime() / 1000;
         long entityTime = entity.getUpdateTime().getTime() / 1000;
         if (boTime != entityTime) {
             throw new ServiceException("æ•°æ®å·²è¢«å…¶ä»–ç”¨æˆ·ä¿®æ”¹ï¼Œè¯·åˆ·æ–°åé‡è¯•");
         }
     }

     // 3. æ­£å¸¸æ›´æ–°ï¼ˆupdateTime ç”± MyBatis-Plus è‡ªåŠ¨å¡«å……ï¼‰
     FinancialSettlement updateEntity = MapstructUtils.convert(bo, FinancialSettlement.class);
     baseMapper.updateById(updateEntity);
 }

 Bo å­—æ®µæ·»åŠ ï¼š
 // FinancialSettlementBo.java æ·»åŠ 
 private Date updateTime;  // å‰ç«¯ä¼ å›çš„æ—¶é—´æˆ³ï¼Œç”¨äºå¹¶å‘æ ¡éªŒ

 9.4 é‡å¤è®¡ç®—é˜²æŠ¤

 // è®¡ç®—åˆ©æ¯æ¥å£å¹‚ç­‰
 public FinancialSettlementVo calculateAdvanceInterest(FinancialSettlementBo bo) {
     // æ¯æ¬¡è®¡ç®—éƒ½ç”Ÿæˆæ–°çš„å…¬å¼å¿«ç…§ï¼ˆè¦†ç›–æ—§å€¼ï¼‰
     // å…¬å¼å¿«ç…§åŒ…å«æ—¶é—´æˆ³å’Œæ“ä½œäººï¼Œç¡®ä¿å¯è¿½æº¯

     String snapshot = buildFormulaSnapshot(bo, result);
     // snapshot åŒ…å«: calculatedAt, calculatedBy, å®Œæ•´è®¡ç®—å‚æ•°

     bo.setFormulaSnapshot(snapshot);
     return MapstructUtils.convert(bo, FinancialSettlementVo.class);
 }

 ---
 åã€å¤ç”¨ç‚¹å…·ä½“åŒ–

 10.1 åç«¯å¤ç”¨ç°æœ‰å®ç°
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚    ç°æœ‰ç»„ä»¶    â”‚         ä½ç½®         â”‚                å¤ç”¨æ–¹å¼                â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ BaseMapperPlus â”‚ ruoyi-common-mybatis â”‚ Expense Mapper ç»§æ‰¿æ­¤åŸºç±»              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ TenantEntity   â”‚ ruoyi-common-tenant  â”‚ Expense Entity ç»§æ‰¿æ­¤åŸºç±»              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ @AutoMapper    â”‚ MapStruct            â”‚ Bo/Vo è‡ªåŠ¨è½¬æ¢                         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ é€»è¾‘åˆ é™¤       â”‚ del_flag å­—æ®µ        â”‚ å·²åœ¨ TenantEntity ä¸­                   â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å®¡æ‰¹æµæŒ‚è½½     â”‚ ProcessEvent ç›‘å¬    â”‚ å¤ç”¨ç°æœ‰ financial_settlement æµç¨‹ä»£ç  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ ç¼–å·ç”Ÿæˆ       â”‚ DocNoGenerator       â”‚ è´¹ç”¨è¡¨æ— éœ€ç¼–å·ï¼ˆæ˜ç»†è¡Œï¼‰               â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 10.2 Mapper æ‰©å±•å¯¹é½

 ç°æœ‰ FinancialSettlementMapperï¼š
 public interface FinancialSettlementMapper
     extends BaseMapperPlus<FinancialSettlement, FinancialSettlementVo> {
     // ç»§æ‰¿ BaseMapperPlus çš„æ‰€æœ‰æ–¹æ³•
 }

 æ–°å¢ FinancialSettlementExpenseMapperï¼š
 public interface FinancialSettlementExpenseMapper
     extends BaseMapperPlus<FinancialSettlementExpense, FinancialSettlementExpenseVo> {

     // æŒ‰ç»“ç®—å•IDæŸ¥è¯¢è´¹ç”¨åˆ—è¡¨
     default List<FinancialSettlementExpenseVo> selectByPid(Long pid) {
         return selectVoList(Wrappers.<FinancialSettlementExpense>lambdaQuery()
             .eq(FinancialSettlementExpense::getPid, pid)
             .orderByAsc(FinancialSettlementExpense::getExpenseType));
     }

     // æ‰¹é‡åˆ é™¤
     default int deleteByPid(Long pid) {
         return delete(Wrappers.<FinancialSettlementExpense>lambdaQuery()
             .eq(FinancialSettlementExpense::getPid, pid));
     }
 }

 10.3 Service æ‰©å±•å¯¹é½

 ç°æœ‰ FinancialSettlementService éœ€æ‰©å±•çš„æ–¹æ³•ï¼š

 // åœ¨ insertByBo/updateByBo ä¸­å¢åŠ è´¹ç”¨æ˜ç»†å¤„ç†
 @Override
 @Transactional
 public void insertByBo(FinancialSettlementBo bo) {
     // 1. ä¿å­˜ä¸»è¡¨ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
     super.insertByBo(bo);

     // 2. ä¿å­˜è´¹ç”¨æ˜ç»†ï¼ˆæ–°å¢ï¼‰
     if (CollUtil.isNotEmpty(bo.getExpenseList())) {
         saveExpenseList(bo.getId(), bo.getExpenseList());
     }
 }

 // åœ¨ queryById ä¸­å¢åŠ è´¹ç”¨æ˜ç»†æŸ¥è¯¢
 @Override
 public FinancialSettlementVo queryById(Long id) {
     FinancialSettlementVo vo = super.queryById(id);

     // æŸ¥è¯¢è´¹ç”¨æ˜ç»†
     vo.setExpenseList(expenseMapper.selectByPid(id));

     return vo;
 }

 10.4 å‰ç«¯æ‰©å±•å¯¹é½

 ç°æœ‰é¡µé¢ç»“æ„ï¼š
 - views/supplychain/financial/settlement/index.vue - åˆ—è¡¨é¡µï¼ˆå·²æœ‰ï¼‰
 - views/supplychain/financial/settlement/edit.vue - ç¼–è¾‘é¡µï¼ˆéœ€æ–°å¢ï¼Œæ— ç°æœ‰é¡µé¢ï¼‰

 å†³ç­–ï¼šæ–°å»ºç¼–è¾‘é¡µ
 - å½“å‰ç³»ç»Ÿæ—  settlement/edit.vueï¼Œéœ€å…¨æ–°åˆ›å»º
 - å‚è€ƒåŒæ¨¡å— payment/edit.vue å¸ƒå±€é£æ ¼
 - æ²¿ç”¨ç°æœ‰æƒé™å‘½åè§„èŒƒ

 æƒé™/è·¯ç”±å‘½åå¯¹é½ï¼ˆæ²¿ç”¨ç°æœ‰è§„èŒƒï¼‰ï¼š
 // ç°æœ‰æƒé™ï¼ˆä¿ç•™ï¼‰
 'financial:settlement:list'    // åˆ—è¡¨æŸ¥è¯¢
 'financial:settlement:query'   // è¯¦æƒ…æŸ¥è¯¢
 'financial:settlement:joint'   // è”æŸ¥
 'financial:settlement:export'  // å¯¼å‡º

 // éœ€æ–°å¢æƒé™ï¼ˆä¸å…¶ä»–å•æ®ä¸€è‡´ï¼‰
 'financial:settlement:add'     // æ–°å¢
 'financial:settlement:edit'    // ç¼–è¾‘
 'financial:settlement:remove'  // åˆ é™¤

 è·¯ç”±é…ç½®ï¼ˆåœ¨èœå•ç®¡ç†ä¸­æ·»åŠ ï¼‰ï¼š
 // çˆ¶èœå•ï¼šè´¢åŠ¡ç®¡ç† - ç»“ç®—ç®¡ç†
 {
   path: 'settlement',
   name: 'Settlement',
   component: () => import('@/views/supplychain/financial/settlement/index.vue'),
   meta: { title: 'ç»“ç®—å•', icon: 'document' }
 }

 // ç¼–è¾‘é¡µè·¯ç”±ï¼ˆéšè—èœå•ï¼‰
 {
   path: 'settlement/edit/:id?',
   name: 'SettlementEdit',
   component: () => import('@/views/supplychain/financial/settlement/edit.vue'),
   meta: { title: 'ç»“ç®—å•ç¼–è¾‘', activeMenu: '/finance/settlementMgr/settlement' },
   hidden: true
 }

 èœå•é…ç½®SQLï¼ˆåœ¨ç³»ç»Ÿç®¡ç†-èœå•ç®¡ç†ä¸­æ‰§è¡Œï¼‰ï¼š
 -- è·å–çˆ¶èœå•IDï¼ˆç»“ç®—å•åˆ—è¡¨é¡µï¼‰
 -- å‡è®¾çˆ¶èœå•IDä¸º @parent_id

 -- æ–°å¢æŒ‰é’®æƒé™
 INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, menu_type, perms, icon, status, tenant_id)
 VALUES ('ç»“ç®—å•æ–°å¢', @parent_id, 2, '', '', 'F', 'financial:settlement:add', '', '0', '000000');

 INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, menu_type, perms, icon, status, tenant_id)
 VALUES ('ç»“ç®—å•ç¼–è¾‘', @parent_id, 3, '', '', 'F', 'financial:settlement:edit', '', '0', '000000');

 INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, menu_type, perms, icon, status, tenant_id)
 VALUES ('ç»“ç®—å•åˆ é™¤', @parent_id, 4, '', '', 'F', 'financial:settlement:remove', '', '0', '000000');

 API æ‰©å±•ï¼ˆsettlement.tsï¼‰ï¼š
 // ç°æœ‰
 export function listSettlement(query) { ... }

 // éœ€æ–°å¢
 export function getSettlement(id: number) { ... }
 export function addSettlement(data: object) { ... }
 export function updateSettlement(data: object) { ... }
 export function delSettlement(ids: string) { ... }
 export function calculateInterest(data: object) { ... }
 export function getExpenseList(id: number) { ... }
 export function saveExpenseList(id: number, data: object[]) { ... }

 10.5 ç¼–è¾‘é¡µè®¾è®¡ï¼ˆå‚è€ƒ payment/edit.vueï¼‰

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚  FlexEdit (ä¸Šä¸‹åˆ†å‰²å¸ƒå±€)                                     â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚  ä¸Šéƒ¨: åŸºæœ¬ä¿¡æ¯å¡ç‰‡                                          â”‚
 â”‚  â”œâ”€ å•æ®ç¼–å·ã€å•æ®æ—¥æœŸã€ä¾›åº”å•†                               â”‚
 â”‚  â”œâ”€ å«èµ„ç±»å‹ã€å«èµ„é‡‘é¢ã€è®¡æ¯èµ·æ­¢æ—¥                           â”‚
 â”‚  â”œâ”€ [è®¡ç®—åˆ©æ¯] æŒ‰é’® â†’ æ˜¾ç¤ºï¼šå¤©æ•°ã€åˆ©ç‡ã€åˆ©æ¯é‡‘é¢             â”‚
 â”‚  â””â”€ é€šé“è´¹ã€è´´æ¯ï¼ˆæ ¹æ®å«èµ„ç±»å‹æ˜¾ç¤ºï¼‰                         â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚  ä¸‹éƒ¨: Tab åˆ‡æ¢                                              â”‚
 â”‚  â”œâ”€ Tab1: å•†å“æ˜ç»†ï¼ˆç°æœ‰ detail è¡¨ï¼‰                        â”‚
 â”‚  â””â”€ Tab2: è´¹ç”¨æ˜ç»†ï¼ˆæ–°å¢ expense è¡¨ï¼‰                       â”‚
 â”‚       â”œâ”€ [æ·»åŠ è´¹ç”¨] æŒ‰é’®                                     â”‚
 â”‚       â””â”€ è´¹ç”¨ç±»å‹ã€æ•°é‡ã€å•ä»·ã€å¤©æ•°ã€é‡‘é¢ã€å¤‡æ³¨              â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚  åº•éƒ¨: FooterButton (ä¿å­˜/æäº¤/è¿”å›)                         â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 ---
 åä¸€ã€å®æ–½æ³¨æ„äº‹é¡¹

 11.1 æ•°å€¼ç²¾åº¦è§„èŒƒ
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ å­—æ®µç±»å‹ â”‚  ç²¾åº¦   â”‚ èˆå…¥æ¨¡å¼ â”‚        è¯´æ˜        â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ é‡‘é¢     â”‚ 2ä½å°æ•° â”‚ HALF_UP  â”‚ åˆ©æ¯ã€è´¹ç”¨ã€åˆè®¡ç­‰ â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ æ—¥åˆ©ç‡   â”‚ 6ä½å°æ•° â”‚ HALF_UP  â”‚ interestRate å­—æ®µ  â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ æ•°é‡     â”‚ 3ä½å°æ•° â”‚ HALF_UP  â”‚ qty å­—æ®µ           â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å•ä»·     â”‚ 6ä½å°æ•° â”‚ HALF_UP  â”‚ unitPrice å­—æ®µ     â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 // æ•°å€¼è®¡ç®—ç¤ºä¾‹
 BigDecimal interest = principal
     .multiply(annualRate)
     .divide(BigDecimal.valueOf(360), 6, RoundingMode.HALF_UP)
     .multiply(BigDecimal.valueOf(days))
     .setScale(2, RoundingMode.HALF_UP);

 11.2 ç¨åŸºç¡®è®¤
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ è´¹ç”¨ç±»å‹ â”‚   ç¨åŸº   â”‚ ç¨ç‡å­—æ®µ â”‚          è¯´æ˜          â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ å«èµ„åˆ©æ¯ â”‚ å«ç¨é‡‘é¢ â”‚ æš‚ä¸è®¡ç®— â”‚ åç»­å¯æ‰©å±•             â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ è´´æ¯     â”‚ å«ç¨é‡‘é¢ â”‚ æš‚ä¸è®¡ç®— â”‚ åç»­å¯æ‰©å±•             â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ é€šé“è´¹   â”‚ æ•°é‡(å¨) â”‚ æš‚ä¸è®¡ç®— â”‚ åç»­å¯æ‰©å±•             â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚ ç‰©æµè´¹ç”¨ â”‚ ç”¨æˆ·å¡«å†™ â”‚ ä¿ç•™å­—æ®µ â”‚ taxRate/taxAmount ç½®é›¶ â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 ç‰©æµè´¹ç”¨çš„ç¨ç‡/ç¨é¢å­—æ®µä¿ç•™ï¼Œæœ¬æœŸæš‚ç½®é›¶ï¼›è‹¥åç»­éœ€è¦ç¨é¢è®¡ç®—ï¼Œå†æ˜ç¡®å•ä»·å«/ä¸å«ç¨å£å¾„

 11.3 é…ç½®è¡¨åˆå§‹åŒ–æ£€æŸ¥

 å¿…é¡»åˆå§‹åŒ–çš„é…ç½®ï¼š
 -- æ£€æŸ¥é…ç½®æ˜¯å¦å­˜åœ¨
 SELECT config_code, rate_value, rate_unit, base_type, calc_method, tier_rules
 FROM financial_expense_config
 WHERE config_code IN ('INTEREST_RATE_SELF', 'INTEREST_RATE_BANK', 'CHANNEL_FEE', 'SUBSIDY_RATE')
   AND status = 1 AND del_flag = '0';

 é€šé“è´¹ tier_rules JSON schemaï¼š
 [
   {"minDays": 0, "maxDays": 30, "rate": 0},
   {"minDays": 31, "maxDays": 9999, "rate": 0.5}
 ]

 11.4 å‰ç«¯æ³¨æ„äº‹é¡¹

 - otherExpensesAmount å­—æ®µè®¾ä¸ºåªè¯»ï¼ˆdisabledï¼‰
 - è´¹ç”¨æ˜ç»† Tab æ‰å¯ç¼–è¾‘è´¹ç”¨
 - ä¿å­˜æ—¶å‘é€ expenseListï¼Œä¸ä¼  seqNoï¼ˆåç«¯è‡ªåŠ¨ç”Ÿæˆï¼‰
 - æŸ¥è¯¢è¯¦æƒ…åç«‹å³å­˜å‚¨ updateTimeï¼Œæäº¤æ—¶å›ä¼ 
 - ç¼–è¾‘é¡µèœå•è®¾ä¸º hidden: trueï¼Œä¿ç•™ activeMenu é«˜äº®

 11.5 æ—¥å¿—/å®¡è®¡

 - è®¡ç®—åˆ©æ¯æ¥å£è®°å½•ï¼šè®¡ç®—äººã€è®¡ç®—æ—¶é—´ã€è¾“å…¥å‚æ•°ã€è¾“å‡ºç»“æœ
 - å…¬å¼å¿«ç…§åŒ…å«ï¼šversionã€calculatedAtã€calculatedByã€calculatedByName
 - å…è®¸é‡å¤è®¡ç®—è¦†ç›–æ—§å¿«ç…§ï¼ˆå¹‚ç­‰ï¼‰

 ---
 åäºŒã€éªŒè¯æ¸…å•

 å£å¾„éªŒæ”¶

 - å«èµ„åˆ©æ¯å£å¾„å·²å†»ç»“ï¼ˆå«éªŒæ”¶ç®—ä¾‹ï¼‰
 - é€šé“è´¹å£å¾„å·²ç¡®è®¤ï¼ˆ30å¤©å…è´¹æœŸ + 0.5å…ƒ/å¨/å¤©ï¼‰
 - è´´æ¯å£å¾„å·²ç¡®è®¤ï¼ˆ2.3%å¹´åŒ–ï¼Œ360å¤©åŸºå‡†ï¼‰
 - ç‰©æµè´¹ç”¨å£å¾„å·²å†»ç»“ï¼ˆå«å•ä»·å’ŒéªŒæ”¶ç®—ä¾‹ï¼‰

 æŠ€æœ¯å®æ–½

 - æ•°æ®åº“è¿ç§»æˆåŠŸï¼ˆALTER TABLE + æ–°è¡¨ï¼‰
 - Entity/Bo/Vo å­—æ®µæ­£ç¡®ï¼ˆå« @AutoMapperï¼‰
 - Mapper ç»§æ‰¿ BaseMapperPlus
 - Service æ‰©å±• insertByBo/updateByBo/queryById
 - Controller æ–°å¢è®¡ç®—/è´¹ç”¨æ˜ç»†æ¥å£
 - å‰ç«¯ç¼–è¾‘é¡µæ–°å¢ï¼ˆå‚è€ƒ payment/edit.vueï¼‰
 - æƒé™/è·¯ç”±é…ç½®å¯¹é½ç°æœ‰å‘½å

 ä¸šåŠ¡é€»è¾‘

 - åˆ©æ¯è®¡ç®—å‡†ç¡®ï¼ˆä¸éªŒæ”¶ç®—ä¾‹ä¸€è‡´ï¼‰
 - é€šé“è´¹è®¡ç®—å‡†ç¡®ï¼ˆä¸éªŒæ”¶ç®—ä¾‹ä¸€è‡´ï¼‰
 - è´´æ¯è®¡ç®—å‡†ç¡®ï¼ˆä¸éªŒæ”¶ç®—ä¾‹ä¸€è‡´ï¼‰
 - è´¹ç”¨æ˜ç»†CRUDæ­£å¸¸
 - å…¬å¼å¿«ç…§JSONæ ¼å¼æ­£ç¡®
 - å®¡æ‰¹å‰æ ¡éªŒå®Œæ•´
 - æäº¤åå…¬å¼å¿«ç…§é”å®š

 å¹¶å‘ä¸éš”ç¦»

 - ä¹è§‚é”é˜²æ­¢å¹¶å‘ä¿®æ”¹
 - è·¨ç§Ÿæˆ·æ•°æ®éš”ç¦»
 - é€»è¾‘åˆ é™¤åŠŸèƒ½æ­£å¸¸
 - é‡å¤è®¡ç®—å¹‚ç­‰
